
    

    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
 lang="en" dir="ltr">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
    Laborator 02 - Operații I/O simple    [CS Open CourseWare]
  </title>

  <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2022-03-11T16:38:33+0200"/>
<meta name="keywords" content="so,laboratoare,laborator-02"/>
<link rel="search" type="application/opensearchdescription+xml" href="/courses/lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="/courses/"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="/courses/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="/courses/feed.php?mode=list&amp;ns=so:laboratoare"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="/courses/_export/xhtml/so/laboratoare/laborator-02"/>
<link rel="canonical" href="http://ocw.cs.pub.ro/courses/so/laboratoare/laborator-02"/>
<link rel="stylesheet" type="text/css" href="/courses/lib/exe/css.php?t=arctic&amp;tseed=1665653400"/>
<script type="text/javascript">/*<![CDATA[*/var NS='so:laboratoare';var JSINFO = {"id":"so:laboratoare:laborator-02","namespace":"so:laboratoare","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/courses/lib/exe/js.php?tseed=1665653400"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>

  <link rel="shortcut icon" href="/courses/lib/tpl/arctic/images/favicon.ico" />

  
</head>
<body>
<div id="wrapper" class='show'>
  <div class="dokuwiki">

    
    <div class="stylehead">
      <div class="header">
        <div class="pagename">
          <a href="/courses/so/"><img height="70" src="/courses//res/sigla_so.png"/> </a>        </div>
        <div class="logo">
          <a style="color: #AAA !important;" href="/courses/systems/"/><img height="70" src="/courses/res/systems.png" name="dokuwiki__top"/></a>        </div>
      </div>
    
       
      <div class="breadcrumbs">
              </div>
      
            </div>

                  <div class="bar" id="bar__top">
        <div class="bar-left">
                  </div>
        <div class="bar-right">
          <a href="/courses/so/laboratoare/laborator-02?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Recent changes [R]">Recent changes</a><a href="/courses/so/laboratoare/laborator-02?do=login&amp;sectok=1981907b783aac32d5ef4a7ff6e4acad"  class="action login" rel="nofollow" title="Login">Login</a>        </div>
    </div>
        
    
    
    
              <div class="left_page">
          
<h1 class="sectionedit1" id="laborator_02_-_operatii_io_simple">Laborator 02 - Operații I/O simple</h1>
<div class="level1">

</div>

<h2 class="sectionedit2" id="materiale_ajutatoare">Materiale ajutătoare</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="http://elf.cs.pub.ro/so/res/tutorial/lab-02-operatii-io/" class="urlextern" title="http://elf.cs.pub.ro/so/res/tutorial/lab-02-operatii-io/"  rel="nofollow"> Video Operații IO</a></div>
</li>
</ul>

</div>

<h3 class="sectionedit3" id="nice_to_read">Nice to read</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> TLPI - Chapter 4, <code>File I/O: The Universal I/O model</code></div>
</li>
<li class="level1"><div class="li"> WSP4 - Chapter 2, <code>Using the Windows File System</code></div>
</li>
</ul>

</div>

<h2 class="sectionedit4" id="fisiere_sisteme_de_fisiere">Fișiere. Sisteme de fișiere</h2>
<div class="level2">

<p>
<strong>Fișierul</strong> este una dintre abstractizările fundamentale în domeniul sistemelor de operare; cealaltă abstractizare este procesul. Dacă procesul abstractizează execuția unei anumite sarcini pe procesor, fișierul abstractizează informația persistentă a unui sistem de operare. Un fișier este folosit pentru a stoca informațiile necesare funcționării sistemului de operare și interacțiunii cu utilizatorul.
</p>

<p>
Un <strong>sistem de fișiere</strong> este un mod de organizare a fișierelor și prezentare a acestora utilizatorului. Din punctul de vedere al utilizatorului, un sistem de fișiere are o structură ierarhică de fișiere și directoare, începând cu un director rădăcină. Localizarea unei intrări (fișier sau director) se realizează cu ajutorul unei căi în care sunt prezentate toate intrările de până atunci. Astfel, pentru calea <code>/usr/local/file.txt</code> directorul rădăcină <code>&#039;/</code>&#039; are un subdirector <code>usr</code> care include subdirectorul <code>local</code> ce conține un fișier <code>file.txt</code>.
</p>

<p>
Fiecare fișier are asociat, așadar, un nume cu ajutorul căruia se face identificarea, un set de drepturi de acces și zone conținând informația utilă.
</p>

<p>
Sistemele de fișiere suportate de sistemele de operare de tip Unix și Windows sunt ierarhice. Sistemele Linux/Unix sunt case-sensitive (<code>Data</code> este diferit de <code>data</code>), iar sistemele Windows sunt case-insensitive.
</p>

<p>
Ierarhia sistemului de fișiere Unix are un singur director cunoscut sub numele de <code>root</code> și notat <code>&#039;/</code>&#039;, prin care se localizează orice fișier (a nu se confunda cu directorul <code>/root</code>, care este home-ul utilizatorului privilegiat, root). Notația Unix pentru căile fișierelor este un șir de nume de directoare despărțite prin <code>&#039;/</code>&#039;, urmat de numele fișierului. Există și căi relative la directorul curent <code>&#039;.</code>&#039; sau la directorul părinte <code>&#039;..</code>&#039;.
</p>

<p>
În Unix nu se face nicio deosebire între fișierele aflate pe partițiile discului local, pe CD sau pe o mașină din rețea. Toate aceste fișiere vor face parte din ierarhia unică a directorului <code>root</code>. Acest lucru se realizează prin <code>montare</code>: sistemele de fișiere vor fi montate într-unul dintre directoarele sistemului de fișiere rădăcină.
</p>

<p>
În Windows există mai multe ierarhii, câte una pentru fiecare partiție și pentru fiecare loc din rețea. Spre deosebire de Unix, delimitatorul între numele directoarelor dintr-o cale este <code>&#039;\</code>&#039;, și pentru căile absolute trebuie specificat numele ierarhiei în forma <code>C:\</code>, <code>E:\</code> sau <code>\\FILESERVER\myFile</code> (pentru rețea). Ca și Unix, Windows folosește <code>&#039;.</code>&#039; pentru directorul curent și <code>&#039;..</code>&#039; pentru directorul părinte. 
</p>

</div>

<h2 class="sectionedit5" id="operatii_pe_fisiere">Operații pe fișiere</h2>
<div class="level2">

<p>
În Unix, un <strong>descriptor de fișier</strong> este un întreg care indexează o tabelă cu pointeri spre structuri care descriu fișierele deschise de un proces. În cazul în care un program rulează într-un shell Unix, procesul părinte (shell-ul) deschide pentru procesul copil (programul respectiv) 3 fișiere standard având descriptori de fișiere cu valori speciale:
</p>

<p>
<a href="/courses/_detail/so/laboratoare/standard_filedes.png?id=so%3Alaboratoare%3Alaborator-02" class="media" title="so:laboratoare:standard_filedes.png"><img src="/courses/_media/so/laboratoare/standard_filedes.png?w=300&amp;tok=066349" class="mediaright" title=" Descriptorii standard de fișiere" alt=" Descriptorii standard de fișiere" width="300" /></a>
</p>
<ul>
<li class="level1"><div class="li"> <strong>standard input </strong> (0) - citirea de la intrarea standard (tastatură)</div>
</li>
<li class="level2"><div class="li"> <strong>standard output</strong> (1) - afișarea la ieşirea standard (consolă)</div>
</li>
<li class="level2"><div class="li"> <strong>standard error </strong> (2) - afișarea la ieşirea standard de eroare (consolă)</div>
</li>
</ul>

<p>
În Windows, noțiunea de bază pentru managementul fișierelor este <strong>handle</strong>-ul, o valoare din care se obține un pointer spre o structură descriptivă a fișierului. Aceleași 3 fișiere standard sunt deschise de fiecare <a href="/courses/so/laboratoare/laborator-03#prezentare-concepte" class="wikilink1" title="so:laboratoare:laborator-03">proces</a>.
</p>

<p>
În continuare, pentru descrierea comportamentului operațiilor de intrare-ieșire pe Windows, s-a ales ca toate apelurile să facă parte din <abbr title="Application Programming Interface">API</abbr>-ul Win32, care este cel mai aproape de kernelul Windows. Sistemul oferă ca alternativă apeluri standard (POSIX, de exemplu, compatibile între Windows și Linux), dar acestea se implementează în Windows prin apelurile Win32 și formează un nivel de abstractizare aflat mai departe de kernel.
</p>

<p>
Un fișier are asociat cursorul de fișier (file pointer) care indică poziția curentă în cadrul fișierului. Cursorul de fișier este un întreg care reprezintă deplasamentul (offset-ul) față de începutul fișierului.
</p>

<p>
Pentru a crea o paralelă între operațiile cu fișiere de pe Linux și Windows, vă punem la dispoziție tabelul de mai jos unde sunt descrise diverse funcționalități împreună cu apelurile de sistem care le implementează.
</p>
<div class="table sectionedit6"><table class="inline">
	<tr class="row0">
		<th class="col0 centeralign">  Descriere  </th><th class="col1 centeralign">  ISO C  </th><th class="col2 centeralign">  Linux  </th><th class="col3 centeralign">  Windows  </th>
	</tr>
	<tr class="row1">
		<td class="col0"> <strong>Deschiderea/crearea unui fișier</strong> - înseamnă asocierea unui descriptor de fișier sau a unui handle cu un fișier identificat prin numele său. </td><td class="col1 centeralign">  <code>fopen</code>  </td><td class="col2 centeralign">  <a href="#open" title="so:laboratoare:laborator-02 ↵" class="wikilink1">open</a>  </td><td class="col3 centeralign">  <a href="#createfile" title="so:laboratoare:laborator-02 ↵" class="wikilink1">CreateFile</a>  </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <strong>Închiderea unui fișier</strong> - înseamnă eliberarea structurilor de fișier asociate procesului și a descriptorului (handle-ului) acelui fișier - doar dacă nu mai există nici o intrare în tabela file descriptorilor care să puncteze spre acea structură. </td><td class="col1"> <code>fclose</code> </td><td class="col2 centeralign">  <a href="#close" title="so:laboratoare:laborator-02 ↵" class="wikilink1">close</a>  </td><td class="col3 centeralign">  <a href="#closehandle" title="so:laboratoare:laborator-02 ↵" class="wikilink1">CloseHandle</a>  </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <strong>Citirea dintr-un fișier</strong> - înseamnă copierea unui bloc de date într-un buffer; după ce se realizează citirea, se actualizează cursorul de fișier. </td><td class="col1 centeralign">  <code>fread</code>  </td><td class="col2 centeralign">  <a href="#read" title="so:laboratoare:laborator-02 ↵" class="wikilink1">read</a>  </td><td class="col3 centeralign">  <a href="#readfile" title="so:laboratoare:laborator-02 ↵" class="wikilink1">ReadFile</a>  </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <strong>Scrierea într-un fișier</strong> - înseamnă copierea unui bloc de date dintr-un buffer în fișier; efectuarea scrierii înseamnă și actualizarea cursorului de fișier. </td><td class="col1 centeralign">  <code>fwrite</code>  </td><td class="col2 centeralign">  <a href="#write" title="so:laboratoare:laborator-02 ↵" class="wikilink1">write</a>  </td><td class="col3 centeralign">  <a href="#writefile" title="so:laboratoare:laborator-02 ↵" class="wikilink1">WriteFile</a>  </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <strong>Poziționarea într-un fișier</strong> - înseamnă schimbarea valorii cursorului de fișier; citirile sau scrierile ulterioare vor porni din locul indicat de acest cursor de fișier. </td><td class="col1 centeralign">  <code>fseek</code>  </td><td class="col2 centeralign">  <a href="#pozitionarea_in_fisier_lseek" title="so:laboratoare:laborator-02 ↵" class="wikilink1">lseek</a>  </td><td class="col3 centeralign">  <a href="#pozitionarea_in_fisier" title="so:laboratoare:laborator-02 ↵" class="wikilink1">SetFilePointer</a>  </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <strong>Schimbarea atributelor unui fișier</strong> - înseamnă stabilirea unor parametri pentru fișier. </td><td class="col1 centeralign">  -    </td><td class="col2 centeralign">  <a href="#operatii_speciale" title="so:laboratoare:laborator-02 ↵" class="wikilink1">fcntl</a>  </td><td class="col3 centeralign">  <a href="https://docs.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-setfileattributesa" class="urlextern" title="https://docs.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-setfileattributesa"  rel="nofollow">SetFileAttributes</a>  </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <strong>Trunchierea fișierelor</strong> - înseamnă modificarea dimensiunii unui fișier. </td><td class="col1 centeralign">  -  </td><td class="col2 centeralign">  <a href="#trunchierea_fisierelor" title="so:laboratoare:laborator-02 ↵" class="wikilink1">ftruncate</a>  </td><td class="col3 centeralign">  <a href="#trunchierea_fisierelor1" title="so:laboratoare:laborator-02 ↵" class="wikilink1">SetEndOfFile</a>  </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <strong>Redirectarea</strong> - înseamnă modificarea unui descriptor de fișier al unui proces (de obicei intrarea, ieșirea sau eroarea standard) către alt descriptor de fișier, de obicei cu scopul de a opera cu un fișier in același mod cu care operam cu intrarea, ieșirea sau eroarea standard. </td><td class="col1 centeralign">  -  </td><td class="col2 centeralign">  <a href="#redirectari" title="so:laboratoare:laborator-02 ↵" class="wikilink1">dup</a>, <a href="#redirectari" title="so:laboratoare:laborator-02 ↵" class="wikilink1">dup2</a>  </td><td class="col3 centeralign">  Modificarea structurii <a href="https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/ns-processthreadsapi-startupinfoa?redirectedfrom=MSDN" class="urlextern" title="https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/ns-processthreadsapi-startupinfoa?redirectedfrom=MSDN"  rel="nofollow"> StartupInfo</a> dată ca argument pentru <a href="https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa?redirectedfrom=MSDN" class="urlextern" title="https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa?redirectedfrom=MSDN"  rel="nofollow">CreateProcess</a>  </td>
	</tr>
</table></div>

</div>

<h2 class="sectionedit7" id="operatii_pe_fisiere_in_linux">Operații pe fișiere în Linux</h2>
<div class="level2">

</div>

<h3 class="sectionedit8" id="crearea_deschiderea_si_inchiderea_fisierelor">Crearea, deschiderea și închiderea fișierelor</h3>
<div class="level3">

</div>

<h4 id="open">open</h4>
<div class="level4">

<p>
Pentru deschiderea/crearea unui fișier se folosește funcția <a href="http://linux.die.net/man/2/open" class="urlextern" title="http://linux.die.net/man/2/open"  rel="nofollow">open</a>.
</p>
<pre class="code c"><span class="kw4">int</span> open<span class="br0">&#40;</span><span class="kw4">const</span> <span class="kw4">char</span> <span class="sy0">*</span>pathname<span class="sy0">,</span> <span class="kw4">int</span> flags<span class="br0">&#41;</span><span class="sy0">;</span>               <span class="coMULTI">/* deschidere */</span>
<span class="kw4">int</span> open<span class="br0">&#40;</span><span class="kw4">const</span> <span class="kw4">char</span> <span class="sy0">*</span>pathname<span class="sy0">,</span> <span class="kw4">int</span> flags<span class="sy0">,</span> mode_t mode<span class="br0">&#41;</span><span class="sy0">;</span>  <span class="coMULTI">/* creare */</span></pre>

</div>

<h4 id="creat">creat</h4>
<div class="level4">

<p>
Pentru crearea de fișiere se poate utiliza și <a href="http://linux.die.net/man/2/creat" class="urlextern" title="http://linux.die.net/man/2/creat"  rel="nofollow">creat</a>:
</p>
<pre class="code c"><span class="kw4">int</span> creat<span class="br0">&#40;</span><span class="kw4">const</span> <span class="kw4">char</span> <span class="sy0">*</span>pathname<span class="sy0">,</span> mode_t mode<span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
Funcția este echivalentă cu apelul <code>open</code> unde flag-ul O_CREAT e setat și fișierul nu există deja:
</p>
<pre class="code c">open<span class="br0">&#40;</span>pathname<span class="sy0">,</span> O_WRONLY <span class="sy0">|</span> O_CREAT <span class="sy0">|</span> O_TRUNC<span class="sy0">,</span> mode<span class="br0">&#41;</span><span class="sy0">;</span></pre>

</div>

<h4 id="close">close</h4>
<div class="level4">

<p>
Închiderea de fișiere se realizează cu <a href="http://linux.die.net/man/2/close" class="urlextern" title="http://linux.die.net/man/2/close"  rel="nofollow">close</a>:
</p>
<pre class="code c"><span class="kw4">int</span> close<span class="br0">&#40;</span><span class="kw4">int</span> fd<span class="br0">&#41;</span></pre>

<p>
O greșeală frecventă de programare este neverificarea codului de eroare întors la <a href="http://linux.die.net/man/2/close" class="urlextern" title="http://linux.die.net/man/2/close"  rel="nofollow">close</a>, pentru că se poate întâmpla ca o eroare la scriere (<code>EIO</code>) să fie întoarsă utilizatorului abia la <code>close</code>. 
</p>

</div>

<h4 id="unlink">unlink</h4>
<div class="level4">

<p>
Ștergerea efectivă a unui fișier de pe disk se realizează cu funcția <a href="http://linux.die.net/man/2/unlink" class="urlextern" title="http://linux.die.net/man/2/unlink"  rel="nofollow">unlink</a>:
</p>
<pre class="code c"><span class="kw4">int</span> unlink<span class="br0">&#40;</span><span class="kw4">const</span> <span class="kw4">char</span> <span class="sy0">*</span>pathname<span class="br0">&#41;</span><span class="sy0">;</span></pre>

</div>

<h4 id="exemplu">Exemplu</h4>
<div class="level4">

<p>
Dacă, spre exemplu, dorim să deschidem fișierul <code>in.txt</code> pentru citire și scriere, cu eventuala creare a acestuia, iar fișierul <code>out.txt</code> pentru scriere, cu trunchiere putem folosi următoarea secvență de cod:
</p>
<dl class="code">
<dt><a href="/courses/_export/code/so/laboratoare/laborator-02?codeblock=5" title="Download Snippet" class="mediafile mf_c">io-01.c</a></dt>
<dd><pre class="code c"><span class="co2">#include &lt;sys/types.h&gt;	/* open */</span>
<span class="co2">#include &lt;sys/stat.h&gt;	/* open */</span>
<span class="co2">#include &lt;fcntl.h&gt;	/* O_RDWR, O_CREAT, O_TRUNC, O_WRONLY */</span>
<span class="co2">#include &lt;unistd.h&gt;	/* close */</span>
&nbsp;
<span class="co2">#include &quot;utils.h&quot;</span>
&nbsp;
<span class="kw4">int</span> main<span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
	<span class="kw4">int</span> rc<span class="sy0">;</span>
	<span class="kw4">int</span> fd1<span class="sy0">,</span> fd2<span class="sy0">;</span>
&nbsp;
	fd1 <span class="sy0">=</span> open<span class="br0">&#40;</span><span class="st0">&quot;in.txt&quot;</span><span class="sy0">,</span> O_RDWR <span class="sy0">|</span> O_CREAT<span class="sy0">,</span> <span class="nu8">0644</span><span class="br0">&#41;</span><span class="sy0">;</span>
	DIE<span class="br0">&#40;</span>fd1 <span class="sy0">&lt;</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="st0">&quot;open in.txt&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
	<span class="coMULTI">/* will fail if out.txt does not exist */</span>
	fd2 <span class="sy0">=</span> open<span class="br0">&#40;</span><span class="st0">&quot;out.txt&quot;</span><span class="sy0">,</span> O_WRONLY <span class="sy0">|</span> O_TRUNC<span class="br0">&#41;</span><span class="sy0">;</span>
	DIE<span class="br0">&#40;</span>fd2 <span class="sy0">&lt;</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="st0">&quot;open out.txt&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
	rc <span class="sy0">=</span> close<span class="br0">&#40;</span>fd1<span class="br0">&#41;</span><span class="sy0">;</span>
        DIE<span class="br0">&#40;</span>rc <span class="sy0">&lt;</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="st0">&quot;close fd1&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
        rc <span class="sy0">=</span> close<span class="br0">&#40;</span>fd2<span class="br0">&#41;</span><span class="sy0">;</span>
        DIE<span class="br0">&#40;</span>rc <span class="sy0">&lt;</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="st0">&quot;close fd2&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
	<span class="kw1">return</span> <span class="nu0">0</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</dd></dl>

<p>
<strong>Atenție!</strong> O greșeală frecventă este omiterea drepturilor de creare a fișierului (0644 în exemplul de mai sus) când se apelează open cu flag-ul O_CREAT setat.
</p>

</div>

<h3 class="sectionedit9" id="scrierea_si_citirea">Scrierea și citirea</h3>
<div class="level3">

</div>

<h4 id="read">read</h4>
<div class="level4">

<p>
Funcția <a href="http://linux.die.net/man/2/read" class="urlextern" title="http://linux.die.net/man/2/read"  rel="nofollow">read</a> e folosită pentru citirea din fișier a maxim <code>count</code> octeți:
</p>
<pre class="code c">ssize_t read<span class="br0">&#40;</span><span class="kw4">int</span> fd<span class="sy0">,</span> <span class="kw4">void</span> <span class="sy0">*</span>buf<span class="sy0">,</span> <span class="kw4">size_t</span> count<span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
Funcția <a href="http://linux.die.net/man/2/read" class="urlextern" title="http://linux.die.net/man/2/read"  rel="nofollow">read</a> întoarce numărul de octeți efectiv citiți, <strong>cel mult</strong> <code>count</code>. Valoarea minimă este de <code>1</code> octet, iar când se ajunge la sfârșitul de fișier se va întoarce <code>0</code>.
</p>

</div>

<h4 id="write">write</h4>
<div class="level4">

<p>
Funcția <a href="http://linux.die.net/man/2/write" class="urlextern" title="http://linux.die.net/man/2/write"  rel="nofollow">write</a> e folosită pentru scrierea în fișier a maxim <code>count</code> octeți:
</p>
<pre class="code c">ssize_t write<span class="br0">&#40;</span><span class="kw4">int</span> fd<span class="sy0">,</span> <span class="kw4">const</span> <span class="kw4">void</span> <span class="sy0">*</span>buf<span class="sy0">,</span> <span class="kw4">size_t</span> count<span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
Valoarea întoarsă este numărul de octeți ce au fost efectiv scriși, <strong>cel mult</strong> <code>count</code>. În mod implicit nu se garantează că la revenirea din <a href="http://linux.die.net/man/2/write" class="urlextern" title="http://linux.die.net/man/2/write"  rel="nofollow">write</a> scrierea în fișier s-a terminat. Pentru a forța actualizarea se poate folosi <a href="http://linux.die.net/man/2/fsync" class="urlextern" title="http://linux.die.net/man/2/fsync"  rel="nofollow">fsync</a> sau fișierul se poate deschide folosind flagul <code>O_FSYNC</code>, caz în care se garantează că după fiecare write fișierul a fost actualizat.
</p>

<p>
<strong>Observație 1</strong>: 
Pentru <a href="http://linux.die.net/man/2/read" class="urlextern" title="http://linux.die.net/man/2/read"  rel="nofollow">read</a>/<a href="http://linux.die.net/man/2/write" class="urlextern" title="http://linux.die.net/man/2/write"  rel="nofollow">write</a> există versiunile <a href="http://linux.die.net/man/2/pread" class="urlextern" title="http://linux.die.net/man/2/pread"  rel="nofollow">pread</a>/<a href="http://linux.die.net/man/2/pwrite" class="urlextern" title="http://linux.die.net/man/2/pwrite"  rel="nofollow">pwrite</a>, care permit specificarea unui offset în fișier de la care să se efectueaze operația de citire/scriere. (De asemenea, există și versiunile <code>pread64</code>/<code>pwrite64</code> care folosesc offset-uri de 64 de biți - pentru a putea specifica offset-uri mai mari decât 4GB).
</p>

<p>
<strong>Observație 2</strong>: 
Asa cum s-a specificat mai sus, functiile read/write nu garateaza citirea/scrierea a <code>count</code> bytes. Pot exista mai multe motive pentru care se observa acest comportament.
</p>
<ul>
<li class="level1"><div class="li"> Apelul read nu citeste &#039;count&#039; bytes cand:</div>
<ul>
<li class="level2"><div class="li"> continutul sursei(fisierul) este mai mic de <code>count</code> bytes</div>
</li>
<li class="level2"><div class="li"> este intrerupt de semnale. (exceptie uninterruptible sleep*). Mai multe informatii la  <a href="https://stackoverflow.com/questions/28501133/does-the-linux-system-call-readfd-buf-count-return-less-than-count-when-fd-i" class="urlextern" title="https://stackoverflow.com/questions/28501133/does-the-linux-system-call-readfd-buf-count-return-less-than-count-when-fd-i"  rel="nofollow">https://stackoverflow.com/questions/28501133/does-the-linux-system-call-readfd-buf-count-return-less-than-count-when-fd-i</a></div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Apelul write nu scrie &#039;count&#039; bytes cand:</div>
<ul>
<li class="level2"><div class="li"> este intrerupt de semnale</div>
</li>
<li class="level2"><div class="li"> spatiu insufiecent pe disc, la depasirea pragului RLIMIT_FSIZE. Mai multe informatii. <a href="https://www.gnu.org/software/libc/manual/html_node/Limits-on-Resources.html" class="urlextern" title="https://www.gnu.org/software/libc/manual/html_node/Limits-on-Resources.html"  rel="nofollow">https://www.gnu.org/software/libc/manual/html_node/Limits-on-Resources.html</a>.</div>
</li>
</ul>
</li>
</ul>

<p>
Astfel pentru a <strong>garanta citirea/scrierea</strong> a intregului numarului de bytes dorit, <strong>se recomanda folosirea apelurilor repetitiv(intr-o bucla)</strong>.
</p>

</div>

<h3 class="sectionedit10" id="pozitionarea_in_fisier_lseek">Poziționarea în fișier (lseek)</h3>
<div class="level3">

</div>

<h4 id="lseek">lseek</h4>
<div class="level4">

<p>
Funcția <a href="http://linux.die.net/man/2/lseek" class="urlextern" title="http://linux.die.net/man/2/lseek"  rel="nofollow">lseek</a> permite mutarea cursorului unui fișier la o poziție absolută sau relativă.
</p>
<pre class="code c"> <span class="kw4">off_t</span> lseek<span class="br0">&#40;</span><span class="kw4">int</span> fd<span class="sy0">,</span> <span class="kw4">off_t</span> offset<span class="sy0">,</span> <span class="kw4">int</span> whence<span class="br0">&#41;</span></pre>

<p>
Parametrul <code>whence</code> reprezintă poziția relativă de la care se face deplasarea:
</p>
<ul>
<li class="level1"><div class="li"><code>SEEK_SET</code> - față de poziția de început</div>
</li>
<li class="level1"><div class="li"><code>SEEK_CUR</code> - față de poziția curentă</div>
</li>
<li class="level1"><div class="li"><code>SEEK_END</code> - față de poziția de sfârșit</div>
</li>
</ul>

<p>
<strong>Observație</strong> <a href="http://linux.die.net/man/2/lseek" class="urlextern" title="http://linux.die.net/man/2/lseek"  rel="nofollow">lseek</a> permite și poziționări după sfârșitul fișierului. Scrierile care se fac în astfel de zone nu se pierd, ceea ce se obține fiind un fișier cu <em>goluri</em>, o zonă care este <em>sărită</em> - nu este alocată pe disc. 
</p>

<p>
Pentru această funcție există și o versiune <a href="http://linux.die.net/man/3/lseek64" class="urlextern" title="http://linux.die.net/man/3/lseek64"  rel="nofollow">lseek64</a> la care offset-ul este pe 64 de biți.
</p>

</div>

<h3 class="sectionedit11" id="trunchierea_fisierelor">Trunchierea fișierelor</h3>
<div class="level3">

<p>
Pe lângă trunchierea la 0 care se poate face prin apelul <code>open</code> cu flag-ul <code>O_TRUNC</code>, se poate specifica trunchierea unui fișier la o dimensiune specificată, prin apelurile de sistem <a href="http://linux.die.net/man/2/ftruncate" class="urlextern" title="http://linux.die.net/man/2/ftruncate"  rel="nofollow">ftruncate</a> și <a href="http://linux.die.net/man/2/ftruncate" class="urlextern" title="http://linux.die.net/man/2/ftruncate"  rel="nofollow">truncate</a>:
<br/>

</p>
<pre class="code c"><span class="kw4">int</span> ftruncate<span class="br0">&#40;</span><span class="kw4">int</span> fd<span class="sy0">,</span> <span class="kw4">off_t</span> length<span class="br0">&#41;</span><span class="sy0">;</span>         
<span class="kw4">int</span> truncate<span class="br0">&#40;</span><span class="kw4">const</span> <span class="kw4">char</span> <span class="sy0">*</span>path<span class="sy0">,</span> <span class="kw4">off_t</span> length<span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
În cazul <a href="http://linux.die.net/man/2/ftruncate" class="urlextern" title="http://linux.die.net/man/2/ftruncate"  rel="nofollow">ftruncate</a>, parametrul <code>fd</code> este file descriptorul obținut cu un apel open, care a asigurat drept de scriere. În cazul <a href="http://linux.die.net/man/2/ftruncate" class="urlextern" title="http://linux.die.net/man/2/ftruncate"  rel="nofollow">truncate</a>, fișierul reprezentat prin <code>path</code> trebuie să aibă drept de scriere.
</p>

</div>

<h3 class="sectionedit12" id="exemplu_utilizare_operatii_io">Exemplu utilizare operații I/O</h3>
<div class="level3">
<dl class="code">
<dt><a href="/courses/_export/code/so/laboratoare/laborator-02?codeblock=10" title="Download Snippet" class="mediafile mf_c">io-2.c</a></dt>
<dd><pre class="code c"><span class="co2">#include &lt;stdio.h&gt;</span>
<span class="co2">#include &lt;string.h&gt;</span>
<span class="co2">#include &lt;stdlib.h&gt;</span>
&nbsp;
<span class="co2">#include &lt;sys/types.h&gt;	/* open */</span>
<span class="co2">#include &lt;sys/stat.h&gt;	/* open */</span>
<span class="co2">#include &lt;fcntl.h&gt;	/* O_CREAT, O_RDONLY */</span>
<span class="co2">#include &lt;unistd.h&gt;	/* close, lseek, read, write */</span>
&nbsp;
<span class="co2">#include &quot;utils.h&quot;</span>
&nbsp;
<span class="coMULTI">/* Print the last 100 bytes from a file */</span>
&nbsp;
<span class="kw4">int</span> main <span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
	<span class="kw4">int</span> fd<span class="sy0">,</span> rc<span class="sy0">;</span>
	<span class="kw4">char</span> <span class="sy0">*</span>buf<span class="sy0">;</span>
	ssize_t bytes_read<span class="sy0">;</span>
&nbsp;
	<span class="coMULTI">/* alocate space for the read buffer */</span>
	buf <span class="sy0">=</span> <a href="http://www.opengroup.org/onlinepubs/009695399/functions/malloc.html"><span class="kw3">malloc</span></a><span class="br0">&#40;</span><span class="nu0">101</span><span class="br0">&#41;</span><span class="sy0">;</span>
	DIE<span class="br0">&#40;</span>buf <span class="sy0">==</span> NULL<span class="sy0">,</span> <span class="st0">&quot;malloc&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
	<span class="coMULTI">/* open file */</span>
	fd <span class="sy0">=</span> open<span class="br0">&#40;</span><span class="st0">&quot;file.txt&quot;</span><span class="sy0">,</span> O_RDONLY<span class="br0">&#41;</span><span class="sy0">;</span>
	DIE<span class="br0">&#40;</span>fd <span class="sy0">&lt;</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="st0">&quot;open&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
	<span class="coMULTI">/* set file pointer at 100 characters
	 _before_ the end of the file */</span>
	rc <span class="sy0">=</span> lseek<span class="br0">&#40;</span>fd<span class="sy0">,</span> <span class="sy0">-</span><span class="nu0">100</span><span class="sy0">,</span> SEEK_END<span class="br0">&#41;</span><span class="sy0">;</span>
	DIE<span class="br0">&#40;</span>rc <span class="sy0">&lt;</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="st0">&quot;lseek&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
	<span class="coMULTI">/* read the last 100 characthers */</span>
	bytes_read <span class="sy0">=</span> read<span class="br0">&#40;</span>fd<span class="sy0">,</span> buf<span class="sy0">,</span> <span class="nu0">100</span><span class="br0">&#41;</span><span class="sy0">;</span>
	DIE<span class="br0">&#40;</span>bytes_read <span class="sy0">&lt;</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="st0">&quot;read&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
	<span class="coMULTI">/* set '\0' at end of buffer for printing purposes*/</span>
	buf<span class="br0">&#91;</span>bytes_read<span class="br0">&#93;</span> <span class="sy0">=</span> <span class="st0">'<span class="es5">\0</span>'</span><span class="sy0">;</span>
&nbsp;
	<a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;the last %ld bytes: <span class="es1">\n</span>%s<span class="es1">\n</span>&quot;</span><span class="sy0">,</span> bytes_read<span class="sy0">,</span> buf<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
	<span class="coMULTI">/* close file */</span>
	rc <span class="sy0">=</span> close<span class="br0">&#40;</span>fd<span class="br0">&#41;</span><span class="sy0">;</span>
	DIE<span class="br0">&#40;</span>rc <span class="sy0">&lt;</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="st0">&quot;close&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
	<span class="coMULTI">/* cleanup */</span>
	<a href="http://www.opengroup.org/onlinepubs/009695399/functions/free.html"><span class="kw3">free</span></a><span class="br0">&#40;</span>buf<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
	<span class="kw1">return</span> <span class="nu0">0</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</dd></dl>

</div>

<h3 class="sectionedit13" id="redirectari">Redirectări</h3>
<div class="level3">

<p>
În Linux redirectările se realizează cu ajutorul funcțiilor de duplicare a descriptorilor de fișiere dup si dup2.
</p>
<pre class="code c"><span class="kw4">int</span> dup<span class="br0">&#40;</span><span class="kw4">int</span> oldfd<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw4">int</span> dup2<span class="br0">&#40;</span><span class="kw4">int</span> oldfd<span class="sy0">,</span> <span class="kw4">int</span> newfd<span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
* dup
</p>
<ul>
<li class="level1"><div class="li"> crează o copie a unui file descriptor.</div>
</li>
<li class="level1"><div class="li"> utilizează cel mai mic număr de descriptor neutilizat.</div>
</li>
<li class="level1"><div class="li"> dacă apelul reușește, vechiul și noul file descriptor pot fi folosiți, ei partajând file offset și file status flags.</div>
</li>
</ul>

<p>
 * dup2
</p>
<ul>
<li class="level1"><div class="li"> asemănător dup, dar în loc să se aleagă cel mai mic descriptor, acesta utilizează new_fd specificat.</div>
</li>
<li class="level1"><div class="li"> dacă new_fd este deja folosit, acesta este mai întâi închis înainte de a fi reutilizat.</div>
</li>
<li class="level1"><div class="li"> dacă old_fd nu este valid, apelul eșueaza iar new_fd nu este închis.</div>
</li>
</ul>

<p>
De exemplu, pentru redirectarea ieșirii în fișierul <code>output.txt</code>, sunt necesare două linii de cod:
</p>
<pre class="code c">fd <span class="sy0">=</span> open<span class="br0">&#40;</span><span class="st0">&quot;output.txt&quot;</span><span class="sy0">,</span> O_RDWR<span class="sy0">|</span>O_CREAT<span class="sy0">|</span>O_TRUNC<span class="sy0">,</span> <span class="nu8">0600</span><span class="br0">&#41;</span><span class="sy0">;</span>
dup2<span class="br0">&#40;</span>fd<span class="sy0">,</span> STDOUT_FILENO<span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
Imaginea de mai jos prezintă utilizarea dup și dup2 în diferite situații pentru o înțelegere mai bună:
</p>
<hr />

<p>
<a href="/courses/_detail/so/laboratoare/dup.png?id=so%3Alaboratoare%3Alaborator-02" class="media" title="so:laboratoare:dup.png"><img src="/courses/_media/so/laboratoare/dup.png" class="media" alt="" /></a>
</p>

</div>

<h3 class="sectionedit14" id="operatii_speciale">Operații speciale</h3>
<div class="level3">

<p>
Funcția <a href="http://linux.die.net/man/2/fcntl" class="urlextern" title="http://linux.die.net/man/2/fcntl"  rel="nofollow">fcntl</a> permite efectuarea unor operații speciale asupra descriptorilor de fișier.
</p>
<div class="hiddenGlobal  hiddenActive"><div class="hiddenElements"></div><div class="hiddenHead  hiddenSinceBeginning"><div class="hiddenOnHidden">
<p>
Click to display ⇲
</p>
</div><div class="hiddenOnVisible">
<p>
Click to hide ⇱
</p>
</div></div> <!-- .hiddenHead --><div class="hiddenBody"><pre class="code C"><span class="kw4">int</span> fcntl<span class="br0">&#40;</span><span class="kw4">int</span> fd<span class="sy0">,</span> <span class="kw4">int</span> cmd<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw4">int</span> fcntl<span class="br0">&#40;</span><span class="kw4">int</span> fd<span class="sy0">,</span> <span class="kw4">int</span> cmd<span class="sy0">,</span> <span class="kw4">long</span> arg<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw4">int</span> fcntl<span class="br0">&#40;</span><span class="kw4">int</span> fd<span class="sy0">,</span> <span class="kw4">int</span> cmd<span class="sy0">,</span> <span class="kw4">struct</span> flock <span class="sy0">*</span>lock<span class="br0">&#41;</span><span class="sy0">;</span></pre>
<div class="table sectionedit15"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> cmd 	</th><th class="col1"> efect</th>
	</tr>
	<tr class="row1">
		<td class="col0"> <code>F_DUPFD</code> </td><td class="col1"> duplicarea unui file descriptor </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>F_GETFD</code> </td><td class="col1"> citește flag-urile pentru <code>fd</code></td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>F_SETFD</code> </td><td class="col1 leftalign"> setează flag-urile pentru <code>fd</code> la valoarea specificată de <code>arg</code>  </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>F_GETFL</code> </td><td class="col1"> citește flag-urile de stare pentru <code>fd</code> </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>F_SETFL</code> </td><td class="col1"> setează flag-urile de stare pentru <code>fd</code> la valoarea specificată de <code>arg</code> </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>F_GETLK</code> </td><td class="col1 leftalign"> obținerea informațiilor despre un lock pe fișier  </td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign"> <code>F_SETLK</code>  </td><td class="col1"> obținerea / eliberarea unui lock pe fișier </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <code>F_SETLKW</code> </td><td class="col1"> similar cu <code>F_SETLK</code> dar se așteaptă terminarea operației </td>
	</tr>
	<tr class="row9">
		<td class="col0"> <code>F_GETOWN</code> </td><td class="col1"> obținerea <code>PID</code>-ului procesului care primește semnalul <code>SIGIO</code> </td>
	</tr>
	<tr class="row10">
		<td class="col0"> <code>F_SETOWN</code> </td><td class="col1"> stabilirea procesului care va primi semnalul <code>SIGIO</code> </td>
	</tr>
</table></div>
</div></div>
<p>
<br/>

</p>

</div>

<h2 class="sectionedit16" id="operatii_pe_fisiere_in_windows">Operații pe fișiere în Windows</h2>
<div class="level2">

</div>

<h3 class="sectionedit17" id="crearea_deschiderea_si_inchiderea">Crearea, deschiderea și închiderea</h3>
<div class="level3">

</div>

<h4 id="createfile">CreateFile</h4>
<div class="level4">

<p>
Pentru a crea un handle asociat cu un fișier, director sau altă resursă abstractizată sub forma unui fișier (port COM, pipe, modem etc.) se folosește funcția <a href="http://msdn.microsoft.com/en-us/library/aa363858%28VS.85%29.aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/aa363858%28VS.85%29.aspx"  rel="nofollow">CreateFile</a>. Funcția se ocupă atât de crearea, cât și de deschiderea unui fișier (și întoarce în ambele cazuri un handle asociat cu fișierul):
</p>
<table class="columns-plugin" style="width:100%">
<tr><td class="columns-plugin first" style="width:50%;">
<pre class="code c">HANDLE CreateFile<span class="br0">&#40;</span>
   LPCTSTR lpFileName<span class="sy0">,</span>
   DWORD dwDesiredAccess<span class="sy0">,</span>
   DWORD dwShareMode<span class="sy0">,</span>
   LPSECURITY_ATTRIBUTES lpSecAttributes<span class="sy0">,</span>
   DWORD dwCreationDisposition<span class="sy0">,</span>
   DWORD dwFlagsAndAttributes<span class="sy0">,</span>
   HANDLE hTemplateFile
<span class="br0">&#41;</span><span class="sy0">;</span></pre>
</td><td class="columns-plugin last">
<pre class="code c"> handle1 <span class="sy0">=</span> CreateFile<span class="br0">&#40;</span>
     <span class="st0">&quot;out.txt&quot;</span><span class="sy0">,</span>
     GENERIC_READ<span class="sy0">,</span>	   <span class="coMULTI">/* access mode */</span>
     FILE_SHARE_READ<span class="sy0">,</span>	   <span class="coMULTI">/* sharing option */</span>
     NULL<span class="sy0">,</span>		   <span class="coMULTI">/* security attributes */</span>
     OPEN_EXISTING<span class="sy0">,</span>	   <span class="coMULTI">/* open only if it exists */</span>
     FILE_ATTRIBUTE_NORMAL<span class="sy0">,</span><span class="coMULTI">/* file attributes */</span>
     NULL
<span class="br0">&#41;</span><span class="sy0">;</span>	</pre>
</td></tr></table>

<p>
<strong>Atenție!</strong> Explicațiile complete se găsesc pe pagina de manual pentru <a href="http://msdn.microsoft.com/en-us/library/aa363858%28VS.85%29.aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/aa363858%28VS.85%29.aspx"  rel="nofollow">CreateFile</a>. În continuare vom prezenta cele mai importante proprietăți.
</p>

<p>
Drepturile de acces cerute la deschiderea fișierului sunt specificate în <code>dwDesiredAccess</code>:
</p>
<ul>
<li class="level1"><div class="li"> <code>GENERIC_WRITE</code></div>
</li>
<li class="level1"><div class="li"> <code>GENERIC_READ</code></div>
</li>
</ul>

<p>
Lista completă <a href="http://msdn.microsoft.com/en-us/library/aa363874%28v=vs.85%29.aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/aa363874%28v=vs.85%29.aspx"  rel="nofollow"> aici</a>
</p>

<p>
Parametrul <code>dwCreationDisposition</code> precizează modul în care apelul acționează în cazul în care fișierul există sau nu; poate avea valori de forma:
</p>
<ul>
<li class="level1"><div class="li"> <code>CREATE_ALWAYS</code> - creează un fișier nou; dacă fișierul există, apelul îl suprascrie, ștergând atributele existente;</div>
</li>
<li class="level2"><div class="li"> <code>CREATE_NEW</code> - creează un fișier nou; apelul eșuează dacă fișierul există deja;</div>
</li>
<li class="level2"><div class="li"> <code>OPEN_ALWAYS</code> - deschide fișierul, dacă acesta există; altfel, se comportă ca și CREATE_NEW;</div>
</li>
<li class="level2"><div class="li"> <code>OPEN_EXISTING</code> - deschide fișierul; dacă nu există, apelul eșuează;</div>
</li>
<li class="level2"><div class="li"> <code>TRUNCATE_EXISTING</code> - deschide fișierul (cu drept de acces <code>GENERIC_WRITE</code>) și îl trunchiază la dimensiunea zero; dacă fișierul nu există, apelul eșuează. </div>
</li>
</ul>

<p>
Dacă fișierul există deja și <code>dwCreationDisposition</code> este <code>CREATE_ALWAYS</code> sau <code>OPEN_ALWAYS</code>, apelul NU eșuează, dar <code>GetLastError</code> returnează <code>ERROR_ALREADY_EXISTS</code>. 
</p>
<div class="hiddenGlobal  hiddenActive"><div class="hiddenElements"></div><div class="hiddenHead  hiddenSinceBeginning"><div class="hiddenOnHidden">
<p>
Mai multe aici
</p>
</div><div class="hiddenOnVisible">
<p>
Mai multe aici
</p>
</div></div> <!-- .hiddenHead --><div class="hiddenBody">
<p>
La deschiderea unui fișier se poate preciza prin parametrul <code>lpSecurityAttributes</code> [in] modul în care handle-ul returnat de apel poate fi moștenit de procesele fii ale procesului apelant. Mai multe detalii în <a href="/courses/so/laboratoare/laborator-03" class="wikilink1" title="so:laboratoare:laborator-03">laboratorul de procese</a>.
</p>

<p>
Un fișier poate fi deschis de mai multe ori (de procese diferite, sau de același proces). În acest caz, la prima deschidere, parametrul <code>dwShareMode</code> [in] va avea una dintre valorile:
</p>
<ul>
<li class="level1"><div class="li"> <code>FILE_SHARE_DELETE</code> permite unor operații de deschidere ulterioare să capete acces de tip delete.</div>
</li>
<li class="level2"><div class="li"> <code>FILE_SHARE_READ</code> permite unor operații de deschidere ulterioare să capete acces de tip read.</div>
</li>
<li class="level2"><div class="li"> <code>FILE_SHARE_WRITE</code> permite unor operații de deschidere ulterioare să capete acces de tip write. </div>
</li>
</ul>

<p>
Un set de flaguri și atribute suplimentare (valabile numai în cazul fișierelor) pot fi precizate în <code>dwFlagsAndAttributes</code> [in]. Valori uzuale sunt:
</p>
<ul>
<li class="level1"><div class="li"> <code>FILE_ATTRIBUTE_NORMAL</code> fișierul nu are alte atribute setate (folosit numai singur)</div>
</li>
<li class="level2"><div class="li"> <code>FILE_ATTRIBUTE_READONLY</code> fișierul va fi read only pentru toate procesele </div>
</li>
</ul>
</div></div>
<p>
<br/>

Pentru copierea și mutarea fișierelor există apelurile <a href="http://msdn.microsoft.com/en-us/library/aa363851(VS.85).aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/aa363851(VS.85).aspx"  rel="nofollow">CopyFile</a>, <a href="http://msdn.microsoft.com/en-us/library/aa365239(VS.85).aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/aa365239(VS.85).aspx"  rel="nofollow">MoveFile</a> și <a href="http://msdn.microsoft.com/en-us/library/aa365512(VS.85).aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/aa365512(VS.85).aspx"  rel="nofollow">ReplaceFile</a>.
Un exemplu de schimbare a atributelor găsiți <a href="http://msdn.microsoft.com/en-us/library/aa365522(v=VS.85).aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/aa365522(v=VS.85).aspx"  rel="nofollow">aici</a>.
</p>

</div>

<h4 id="closehandle">CloseHandle</h4>
<div class="level4">

<p>
Când fișierul nu mai este folosit, fișierul este închis cu apelul generic pentru orice tip de handle-uri <a href="http://msdn.microsoft.com/en-us/library/ms724211%28VS.85%29.aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/ms724211%28VS.85%29.aspx"  rel="nofollow">CloseHandle</a>
</p>
<pre class="code C">BOOL CloseHandle<span class="br0">&#40;</span>HANDLE hObject<span class="br0">&#41;</span><span class="sy0">;</span></pre>

</div>

<h4 id="deletefile">DeleteFile</h4>
<div class="level4">

<p>
Ștergerea se face prin închiderea fișierului și folosirea apelului de sistem <a href="http://msdn.microsoft.com/en-us/library/aa363915%28VS.85%29.aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/aa363915%28VS.85%29.aspx"  rel="nofollow">DeleteFile</a>
</p>
<pre class="code C">CloseHandle<span class="br0">&#40;</span>hFile<span class="br0">&#41;</span><span class="sy0">;</span>
DeleteFile<span class="br0">&#40;</span><span class="st0">&quot;myfile.txt&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
unde <a href="http://msdn.microsoft.com/en-us/library/aa363915%28VS.85%29.aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/aa363915%28VS.85%29.aspx"  rel="nofollow">DeleteFile</a> are signatura
</p>
<pre class="code C">BOOL DeleteFile<span class="br0">&#40;</span>LPCTSTR lpFileName<span class="br0">&#41;</span><span class="sy0">;</span></pre>

</div>

<h3 class="sectionedit18" id="citirea_si_scrierea">Citirea și scrierea</h3>
<div class="level3">

</div>

<h4 id="readfile">ReadFile</h4>
<div class="level4">

<p>
<a href="http://msdn.microsoft.com/en-us/library/aa365467%28VS.85%29.aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/aa365467%28VS.85%29.aspx"  rel="nofollow">ReadFile</a> operează asupra unui fișier care are drepturi de acces cel puțin pentru citire, copiind un număr de octeți (începând cu poziția curentă a cursorului de fișier) într-un buffer și întoarce într-o variabilă numărul de octeți citiți. 
</p>
<table class="columns-plugin" style="width:100%">
<tr><td class="columns-plugin first" style="width:50%;">
<pre class="code c">BOOL ReadFile<span class="br0">&#40;</span>
      HANDLE hFile<span class="sy0">,</span>
      LPVOID lpBuffer<span class="sy0">,</span>
      DWORD nNumberOfBytesToRead<span class="sy0">,</span>
      LPDWORD lpNumberOfBytesRead<span class="sy0">,</span>
      LPOVERLAPPED lpOverlapped
<span class="br0">&#41;</span><span class="sy0">;</span></pre>
</td><td class="columns-plugin last">
<pre class="code c">bRet <span class="sy0">=</span> ReadFile<span class="br0">&#40;</span>
   hFile<span class="sy0">,</span>        <span class="coMULTI">/* open file handle */</span>
   lpBuffer<span class="sy0">,</span>     <span class="coMULTI">/* where to put data */</span>
   dwBytesToRead<span class="sy0">,</span><span class="coMULTI">/* number of bytes to read */</span>
   <span class="sy0">&amp;</span>dwBytesRead<span class="sy0">,</span> <span class="coMULTI">/* number of bytes that were read */</span>
   NULL          <span class="coMULTI">/* no overlapped structure */</span>
<span class="br0">&#41;</span><span class="sy0">;</span></pre>
</td></tr></table>

<p>
<a href="http://msdn.microsoft.com/en-us/library/aa365467%28VS.85%29.aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/aa365467%28VS.85%29.aspx"  rel="nofollow">ReadFile</a> primește un handle de fișier <code>hFile</code>, creat anterior cu drepturi cel puțin de citire. Rezultatul citirii este copiat în <code>lpBuffer</code>, iar numărul de octeți efectiv citiți este întors în variabila pointată de <code>lpNumberOfBytesRead</code>. Numărul de octeți efectiv citiți poate fi mai mic decât numărul de octeți care se doresc a fi citiți - <code>nNumberOfBytesToRead</code>.
</p>

<p>
În mod normal, după acest apel, cursorul de fișier este actualizat cu numărul de octeți citiți. Singura excepție este cazul în care fișierul este deschis pentru operații de I/O de tip <code>OVERLAPPED</code> - asincrone, caz în care conceptul de cursor de fișier nu mai este folositor (și deci nu mai este actualizat). Mai multe detalii despre operațiile asincrone în <a href="/courses/so/laboratoare/laborator-10" class="wikilink1" title="so:laboratoare:laborator-10">Laborator 10 - Operatii IO avansate - Windows</a>.
</p>

<p>
<a href="http://msdn.microsoft.com/en-us/library/aa365467%28VS.85%29.aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/aa365467%28VS.85%29.aspx"  rel="nofollow">ReadFile</a> returnează o valoare diferită de zero în caz de succes, și zero altfel. Dacă se returnează o valoare diferită de zero, dar numărul de octeți citiți este zero, atunci s-a ajuns la sfârșitul de fișier.
</p>

</div>

<h4 id="writefile">WriteFile</h4>
<div class="level4">

<p>
Apelul <a href="http://msdn.microsoft.com/en-us/library/aa365747%28VS.85%29.aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/aa365747%28VS.85%29.aspx"  rel="nofollow">WriteFile</a> copiază în mod sincron sau asincron un număr specificat de octeți dintr-un buffer în conținutul unui fișier și returnează într-o variabilă numărul efectiv de octeți copiați. Scrierea în fișier se face în general începând din poziția curentă a cursorului și după terminarea operației, poziția cursorului fișierului este actualizată (rămân valabile observațiile anterioare despre operații <code>OVERLAPPED</code>).
</p>
<table class="columns-plugin" style="width:100%">
<tr><td class="columns-plugin first" style="width:50%;">
<pre class="code c">BOOL WriteFile<span class="br0">&#40;</span>
      HANDLE hFile<span class="sy0">,</span>
      LPCVOID lpBuffer<span class="sy0">,</span>
      DWORD nNumberOfBytesToWrite<span class="sy0">,</span>
      LPDWORD lpNumberOfBytesWritten<span class="sy0">,</span>
      LPOVERLAPPED lpOverlapped
<span class="br0">&#41;</span><span class="sy0">;</span></pre>
</td><td class="columns-plugin last">
<pre class="code c">bRet <span class="sy0">=</span> WriteFile<span class="br0">&#40;</span> 
   hFile<span class="sy0">,</span>          <span class="coMULTI">/* open file handle */</span>
   lpBuffer<span class="sy0">,</span>       <span class="coMULTI">/* start of data to write */</span>
   dwBytesToWrite<span class="sy0">,</span> <span class="coMULTI">/* number of bytes to write */</span>
   <span class="sy0">&amp;</span>dwBytesWritten<span class="sy0">,</span><span class="coMULTI">/* number of bytes that were written */</span>
   NULL            <span class="coMULTI">/* no overlapped structure */</span>
<span class="br0">&#41;</span><span class="sy0">;</span></pre>
</td></tr></table>

<p>
Handle-ul de fișier în care se scrie <code>hFile</code> [in] trebuie să fi fost creat cu drepturi de acces <code>GENERIC_WRITE</code>. Parametrii <a href="http://msdn.microsoft.com/en-us/library/aa365747%28VS.85%29.aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/aa365747%28VS.85%29.aspx"  rel="nofollow">WriteFile</a> au aceleași semnificații cu parametrii <a href="http://msdn.microsoft.com/en-us/library/aa365467%28VS.85%29.aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/aa365467%28VS.85%29.aspx"  rel="nofollow">ReadFile</a>, adaptate pentru operații de scriere.
</p>

</div>

<h3 class="sectionedit19" id="pozitionarea_in_fisier">Poziționarea în fișier</h3>
<div class="level3">

</div>

<h4 id="setfilepointer">SetFilePointer</h4>
<div class="level4">

<p>
Fiecare fișier deschis are asociat un cursor (memorat pe 64 de biți) care reprezintă poziția curentă de citire/scriere. Un proces poziționează cursorul la un offset specificat cu <a href="http://msdn.microsoft.com/en-us/library/aa365541(VS.85).aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/aa365541(VS.85).aspx"  rel="nofollow">SetFilePointer</a>:
</p>
<table class="columns-plugin" style="width:100%">
<tr><td class="columns-plugin first" style="width:50%;">
<pre class="code c">DWORD SetFilePointer<span class="br0">&#40;</span>
         HANDLE hFile<span class="sy0">,</span>
         LONG lDistanceToMove<span class="sy0">,</span>
         PLONG lpDistanceToMoveHigh<span class="sy0">,</span>
         DWORD dwMoveMethod
<span class="br0">&#41;</span><span class="sy0">;</span></pre>
</td><td class="columns-plugin last">
<pre class="code c"><span class="coMULTI">/* Example: How to get current position */</span>
currentPos <span class="sy0">=</span> SetFilePointer<span class="br0">&#40;</span> 
               myFileHandle<span class="sy0">,</span>
               <span class="nu0">0</span><span class="sy0">,</span>           <span class="coMULTI">/* offset 0 */</span>
               NULL<span class="sy0">,</span>        <span class="coMULTI">/* no 64bytes offset */</span>
               FILE_CURRENT 
<span class="br0">&#41;</span><span class="sy0">;</span></pre>
</td></tr></table>

<p>
Deplasarea se face asupra unui fișier reprezentat prin handle-ul <code>hFile</code> deschis în prealabil, creat cu unul din drepturile de acces <code>GENERIC_READ</code> sau <code>GENERIC_WRITE</code>. O valoare pozitivă înseamnă o deplasare înainte, iar una negativă, înapoi.
</p>

<p>
Numărul de octeți cu care se mută cursorul este specificat de <code>lDistanceToMove</code> [in] și <code>lpDistanceToMoveHigh</code>; cele două câmpuri de 32 de biți formează o valoare de 64 de biți. Uzual cel de-al doilea câmp este NULL. 
</p>

<p>
Parametrul <code>dwMoveMethod</code> specifică punctul de start pentru mutarea cursorului, și poate avea una dintre valorile:
</p>
<ul>
<li class="level1"><div class="li"> <code>FILE_BEGIN</code> - punctul de start este începutul fișierului; <code>lDistanceToMove</code> este considerat unsigned</div>
</li>
<li class="level2"><div class="li"> <code>FILE_CURRENT</code> - punctul de start este valoarea curentă a cursorului</div>
</li>
<li class="level2"><div class="li"> <code>FILE_END</code> - punctul de start este valoarea curentă a sfârșitului de fișier </div>
</li>
</ul>

<p>
Apelul returnează noua valoare a cursorului, dacă <code>lpDistanceToMoveHigh</code> este NULL; altfel, se returnează jumătatea low a valorii, jumătatea high luând locul lpDistanceToMoveHigh. 
</p>

<p>
Varianta extinsă <a href="http://msdn.microsoft.com/en-us/library/aa365542(VS.85).aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/aa365542(VS.85).aspx"  rel="nofollow">SetFilePointerEx</a> a apelului <a href="http://msdn.microsoft.com/en-us/library/aa365541(VS.85).aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/aa365541(VS.85).aspx"  rel="nofollow">SetFilePointer</a> memorează valoarea cursorului într-un singur câmp, în loc de două câmpuri separate, apelul extins făcând lucrul cu valorile cursorului mai ușor.
</p>

</div>

<h3 class="sectionedit20" id="trunchierea_fisierelor1">Trunchierea fișierelor</h3>
<div class="level3">

</div>

<h4 id="setendoffile">SetEndOfFile</h4>
<div class="level4">

<p>
Un fișier poate fi trunchiat sau extins folosind apelul <a href="http://msdn.microsoft.com/en-us/library/aa365531(VS.85).aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/aa365531(VS.85).aspx"  rel="nofollow">SetEndOfFile</a>, care face poziția sfârșitului de fișier <abbr title="End of file">EOF</abbr> egală cu poziția curentă a cursorului fișierului. În cazul extinderii fișierului peste limita sa, conținutul adăugat este nedefinit.
</p>
<pre class="code c"> BOOL SetEndOfFile<span class="br0">&#40;</span>HANDLE hFile<span class="br0">&#41;</span><span class="sy0">;</span></pre>

</div>

<h3 class="sectionedit21" id="exemplu1">Exemplu</h3>
<div class="level3">
<dl class="code">
<dt><a href="/courses/_export/code/so/laboratoare/laborator-02?codeblock=26" title="Download Snippet" class="mediafile mf_c">win_io.c</a></dt>
<dd><pre class="code c"><span class="co2">#include &lt;stdio.h&gt;</span>
<span class="co2">#include &lt;string.h&gt;</span>
<span class="co2">#include &lt;stdlib.h&gt;</span>
<span class="co2">#include &lt;windows.h&gt;</span>
&nbsp;
<span class="co2">#include &quot;utils.h&quot;</span>
&nbsp;
<span class="co2">#define BUF_SIZE	100</span>
&nbsp;
<span class="kw4">int</span> main <span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
	HANDLE hFile<span class="sy0">;</span>
	DWORD dwBytesRead<span class="sy0">,</span> dwPos<span class="sy0">,</span> dwBytesToRead <span class="sy0">=</span> BUF_SIZE<span class="sy0">,</span> dwRet<span class="sy0">;</span>
	BOOL bRet<span class="sy0">;</span>
	CHAR outBuffer<span class="br0">&#91;</span>BUF_SIZE<span class="sy0">+</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="sy0">;</span>
&nbsp;
	<span class="coMULTI">/* deschidem fisierul */</span>
	hFile <span class="sy0">=</span> CreateFile<span class="br0">&#40;</span>
			<span class="st0">&quot;file.txt&quot;</span><span class="sy0">,</span>
			GENERIC_READ<span class="sy0">,</span>
			FILE_SHARE_READ<span class="sy0">,</span>
			NULL<span class="sy0">,</span>	<span class="coMULTI">/* no security attributes */</span>
			OPEN_EXISTING<span class="sy0">,</span>
			FILE_ATTRIBUTE_NORMAL<span class="sy0">,</span>
			NULL	<span class="coMULTI">/* no pattern */</span>
		<span class="br0">&#41;</span><span class="sy0">;</span>
	DIE<span class="br0">&#40;</span>hFile <span class="sy0">==</span> INVALID_HANDLE_VALUE<span class="sy0">,</span> <span class="st0">&quot;CreateFile&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
	<span class="coMULTI">/* set file pointer at 100 bytes
	_before_ the end of file */</span>
	dwPos <span class="sy0">=</span> SetFilePointer<span class="br0">&#40;</span>
			hFile<span class="sy0">,</span>
			<span class="sy0">-</span><span class="nu0">100</span><span class="sy0">,</span>
			NULL<span class="sy0">,</span>	<span class="coMULTI">/* used only for offsets on 64bytes */</span>
			FILE_END
	<span class="br0">&#41;</span><span class="sy0">;</span>
	DIE<span class="br0">&#40;</span>dwPos <span class="sy0">==</span> INVALID_SET_FILE_POINTER<span class="sy0">,</span> <span class="st0">&quot;SetFilePointer&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
	<span class="coMULTI">/* read last 100 bytes into buffer */</span>
	dwRet <span class="sy0">=</span> ReadFile<span class="br0">&#40;</span>
			hFile<span class="sy0">,</span>
			outBuffer<span class="sy0">,</span>
			dwBytesToRead<span class="sy0">,</span>
			<span class="sy0">&amp;</span>dwBytesRead<span class="sy0">,</span>
			NULL<span class="br0">&#41;</span><span class="sy0">;</span>	<span class="coMULTI">/* do nothing asynchronous */</span>
	DIE<span class="br0">&#40;</span>dwRet <span class="sy0">==</span> FALSE<span class="sy0">,</span> <span class="st0">&quot;ReadFile&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
	<span class="coMULTI">/* print buffer */</span>
	outBuffer<span class="br0">&#91;</span>dwBytesRead<span class="br0">&#93;</span> <span class="sy0">=</span> <span class="st0">'<span class="es5">\0</span>'</span><span class="sy0">;</span>
	<a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;last %ld bytes: <span class="es1">\n</span>%s<span class="es1">\n</span>&quot;</span><span class="sy0">,</span> dwBytesRead<span class="sy0">,</span> outBuffer<span class="br0">&#41;</span><span class="sy0">;</span>
	<a href="http://www.opengroup.org/onlinepubs/009695399/functions/fflush.html"><span class="kw3">fflush</span></a><span class="br0">&#40;</span>stdout<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
	<span class="coMULTI">/* close file */</span>
	bRet <span class="sy0">=</span> CloseHandle <span class="br0">&#40;</span>hFile<span class="br0">&#41;</span><span class="sy0">;</span>
	DIE<span class="br0">&#40;</span>bRet <span class="sy0">==</span> FALSE<span class="sy0">,</span> <span class="st0">&quot;CloseHandle&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
	<span class="kw1">return</span> <span class="nu0">0</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</dd></dl>

</div>

<h3 class="sectionedit22" id="wrapper-e">Wrapper-e</h3>
<div class="level3">
<div class="hiddenGlobal  hiddenActive"><div class="hiddenElements"></div><div class="hiddenHead  hiddenSinceBeginning"><div class="hiddenOnHidden">
<p>
Click to display ⇲
</p>
</div><div class="hiddenOnVisible">
<p>
Click to hide ⇱
</p>
</div></div> <!-- .hiddenHead --><div class="hiddenBody">
<p>
În domeniul sistemelor de operare, prin wrapper înțelegem un layer software subțire (care nu aduce un overhead prea mare) peste sistemul de operare, cu scopul de a abstractiza serviciile oferite de acesta, adaptându-le la o interfață comună. Interfața comună este definită astfel încât să se potrivească cu mai multe sisteme de operare. Programele pe care le scriem ulterior nu vor folosi direct apelurile de sistem specifice fiecărui sistem de operare, ci interfața comună.
</p>

<p>
Un wrapper este folositor atunci când dorim să scriem software portabil pe mai multe platforme (spre exemplu, temele de la Sisteme de Operare) cu un “overhead” minim de portare și fără a plăti un cost de performanță prea scump (există și alte soluții pentru această problemă, de exemplu, mașina virtuală Java - JVM).
</p>

<p>
Una din metodele posibile pentru realizarea unui wrapper este folosirea preprocesorului. Să presupunem că încercăm să abstractizăm conceptul de fișier și operațiile disponibile cu el. Vom exemplifica doar operațiile de read/write.
</p>
<dl class="code">
<dt><a href="/courses/_export/code/so/laboratoare/laborator-02?codeblock=27" title="Download Snippet" class="mediafile mf_h">io-wrapper.h</a></dt>
<dd><pre class="code c"><span class="co2">#ifdef __linux__</span>
&nbsp;
<span class="co2">#include &lt;sys/types.h&gt;</span>
<span class="co2">#include &lt;sys/stat.h&gt;</span>
<span class="co2">#include &lt;unistd.h&gt;</span>
<span class="co2">#include &lt;fcntl.h&gt;</span>
&nbsp;
<span class="kw4">typedef</span> <span class="kw4">int</span> os_handle<span class="sy0">;</span>
<span class="kw4">typedef</span> <span class="kw4">size_t</span> os_size<span class="sy0">;</span> 
<span class="kw4">typedef</span> ssize_t os_ssize<span class="sy0">;</span> 
&nbsp;
<span class="co2">#elif defined(_WIN32)</span>
&nbsp;
<span class="co2">#include &lt;windows.h&gt;</span>
&nbsp;
<span class="kw4">typedef</span> HANDLE os_handle<span class="sy0">;</span>
<span class="kw4">typedef</span> DWORD os_size<span class="sy0">;</span>
<span class="kw4">typedef</span> DWORD os_ssize<span class="sy0">;</span>
&nbsp;
<span class="co2">#else </span>
<span class="co2">#error &quot;Unknown OS!&quot;</span>
<span class="co2">#endif</span>
&nbsp;
os_ssize os_read<span class="br0">&#40;</span>os_handle fd<span class="sy0">,</span> <span class="kw4">void</span> <span class="sy0">*</span>buffer<span class="sy0">,</span> os_size count<span class="br0">&#41;</span><span class="sy0">;</span>
os_ssize os_write<span class="br0">&#40;</span>os_handle fd<span class="sy0">,</span> <span class="kw4">const</span> <span class="kw4">void</span> <span class="sy0">*</span>buffer<span class="sy0">,</span> os_size count<span class="br0">&#41;</span><span class="sy0">;</span></pre>
</dd></dl>

<p>
Se observă că în funcție de sistemul de operare definit, diferă:
</p>
<ul>
<li class="level1"><div class="li"> fișierele header incluse</div>
</li>
<li class="level2"><div class="li"> definițiile tipurilor cu care lucrează wrapper-ul </div>
</li>
</ul>

<p>
De asemenea, se observă că semnăturile funcțiilor definite sunt identice pentru ambele sisteme de operare. Iată un exemplu de implementare a lor:
</p>
<dl class="code">
<dt><a href="/courses/_export/code/so/laboratoare/laborator-02?codeblock=28" title="Download Snippet" class="mediafile mf_c">io-wrapper.c</a></dt>
<dd><pre class="code c"><span class="co2">#include &quot;io-wrapper.h&quot;</span>
&nbsp;
<span class="co2">#ifdef __linux__</span>
&nbsp;
os_ssize os_read<span class="br0">&#40;</span>os_handle fd<span class="sy0">,</span> <span class="kw4">void</span> <span class="sy0">*</span>buffer<span class="sy0">,</span> os_size count<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    <span class="kw1">return</span> read<span class="br0">&#40;</span>fd<span class="sy0">,</span> buffer<span class="sy0">,</span> count<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
os_ssize os_write<span class="br0">&#40;</span>os_handle fd<span class="sy0">,</span> <span class="kw4">const</span> <span class="kw4">void</span> <span class="sy0">*</span>buffer<span class="sy0">,</span> os_size count<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    <span class="kw1">return</span> write<span class="br0">&#40;</span>fd<span class="sy0">,</span> buffer<span class="sy0">,</span> count<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="co2">#elif defined(_WIN32)</span>
&nbsp;
os_ssize os_read<span class="br0">&#40;</span>os_handle fd<span class="sy0">,</span> <span class="kw4">void</span> <span class="sy0">*</span>buffer<span class="sy0">,</span> os_size count<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    os_ssize result <span class="sy0">=</span> <span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span>
    ReadFile<span class="br0">&#40;</span>fd<span class="sy0">,</span> buffer<span class="sy0">,</span> count<span class="sy0">,</span> <span class="sy0">&amp;</span>result<span class="sy0">,</span> NULL<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">return</span> result<span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
os_ssize os_write<span class="br0">&#40;</span>os_handle fd<span class="sy0">,</span> <span class="kw4">void</span> <span class="sy0">*</span>buffer<span class="sy0">,</span> os_size count<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    os_ssize result <span class="sy0">=</span> <span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span>
    WriteFile<span class="br0">&#40;</span>fd<span class="sy0">,</span> buffer<span class="sy0">,</span> count<span class="sy0">,</span> <span class="sy0">&amp;</span>result<span class="sy0">,</span> NULL<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">return</span> result<span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="co2">#endif</span></pre>
</dd></dl>

<p>
Acum putem genera fișiere executabile compatibile cu o platformă Linux sau Windows, în funcție de un singur macro, definit automat de către compilator.
</p>

<p>
Se observă că folosind această tehnică putem să convertim inclusiv între procedură și funcție (funcțiile de pe Windows primesc ca parametru transmis prin referință numărul de octeți citiți/scriși, iar cele de pe Linux îl întorc direct). Desigur, abordarea de mai sus este incompletă, pentru că ar fi trebuit convertite și codurile de eroare într-un format comun.
</p>

<p>
Odată scris acest wrapper, putem folosi în continuare funcțiile os_read și os_write pentru a citi / scrie din fișiere, fară a ne preocupa de sistemul de operare pe care rulează programul nostru. Acesta este însă un caz fericit, pentru că așa după cum veți observa la laboratorul de procese, nu toate serviciile oferite de sisteme de operare diferite se pot “unifica” atât de ușor (este vorba de fork() + exec() vs. CreateProcess). 
</p>
</div></div>
</div>

<h2 class="sectionedit23" id="exercitii">Exerciții</h2>
<div class="level2">

<p>
<p><div class="noteimportant">
În cadrul laboratoarelor vom folosi repository-ul de git al materiei SO - <a href="https://github.com/systems-cs-pub-ro/so" class="urlextern" title="https://github.com/systems-cs-pub-ro/so"  rel="nofollow">https://github.com/systems-cs-pub-ro/so</a>. Va trebui sa clonați repository-ul pe masinile virtuale folosind comanda: <code>git clone <a href="https://github.com/systems-cs-pub-ro/so" class="urlextern" title="https://github.com/systems-cs-pub-ro/so"  rel="nofollow">https://github.com/systems-cs-pub-ro/so</a></code>. Dacă doriți să descărcați repositoryul în altă locație, folosiți comanda <code>git clone <a href="https://github.com/systems-cs-pub-ro/so" class="urlextern" title="https://github.com/systems-cs-pub-ro/so"  rel="nofollow">https://github.com/systems-cs-pub-ro/so</a> ${target}</code>.
</p>

<p>
Pentru a actualiza repository-ul, folosiți comanda <code>git pull origin master</code> din interiorul directorului în care se află repository-ul. Recomandarea este să îl actualizați cât mai frecvent, înainte să începeți lucrul, pentru a vă asigura că aveți versiunea cea mai recentă. În cazul în care gitul detectează conflicte la nivelul vreunui fişier, folosiți următoarele comenzi pentru a vă păstra modificările:
</p>
<pre class="code">git stash
git pull origin master
git stash pop</pre>

<p>
Pentru mai multe informații despre folosirea utilitarului git, urmați ghidul de la <a href="https://gitimmersion.com" class="urlextern" title="https://gitimmersion.com"  rel="nofollow">https://gitimmersion.com</a>.

</div></p>
</p>

<p>
<strong>Observații</strong>: Pentru a vă ajuta la implementarea exercițiilor din laborator, în directorul <code>utils</code> din arhivă există un fișier <code>utils.h</code> cu funcții utile.
</p>

<p>
<p><div class="noteimportant">Folosiți <code>man</code>/<code>MSDN</code> pentru informații despre apelurile de sistem
</div></p>
<p><div class="notewarning">   <strong>Verificați valorile de retur a apelurilor de sistem</strong><br/>

Puteți folosi macro-ul <a href="https://ocw.cs.pub.ro/courses/so/laboratoare/resurse/die" class="urlextern" title="https://ocw.cs.pub.ro/courses/so/laboratoare/resurse/die"  rel="nofollow"> DIE</a>(valoare_retur == eroare, “mesaj eroare”);

</div></p>
</p>

</div>

<h3 class="sectionedit24" id="exercitiul_0_-_stagii_pe_bune">Exercițiul 0 - Stagii pe bune</h3>
<div class="level3">

<p>
<a href="https://stagiipebune.ro/students/jobs/" class="urlextern" title="https://stagiipebune.ro/students/jobs/"  rel="nofollow">Stagii pe bune</a> este o platformă de internshipuri care vrea să ușureze și să uniformizeze procesul prin care puteți aplica la companii din România (București, Iași, Cluj și Timișoara). Facultatea de Automatică și Calculatoare are un parteneriat cu Stagii pe bune și vă încurajăm să le folosiți platforma pentru a aplica la internshipuri! 
</p>

<p>
Stagii pe bune organizează și evenimente de prezentare a celor mai mari companii din România. Pentru a fi la curent cu acestea, urmăriți și anunțurile postate de Stagii pe bune pe <a href="https://www.facebook.com/stagiipebune" class="urlextern" title="https://www.facebook.com/stagiipebune"  rel="nofollow">Facebook</a>.
</p>

</div>

<h2 class="sectionedit25" id="linux">Linux</h2>
<div class="level2">

</div>

<h3 class="sectionedit26" id="exercitiul_1_-_redirect">Exercițiul 1 - redirect</h3>
<div class="level3">

<p>
Intrați în directorul <code>1-redirect</code> și urmăriți conținutul fișierului <code>redirect.c</code>. 
</p>

<p>
Compilați fișierul (folosiți <code>make</code>). Rulați programul obținut folosind comanda <code>./redirect</code>.
</p>

<p>
Deschideți alt terminal și rulați comanda:
</p>
<pre class="code bash"> <span class="kw2">watch</span> <span class="re5">-d</span> lsof <span class="re5">-p</span> $<span class="br0">&#40;</span><span class="kw2">pidof</span> redirect<span class="br0">&#41;</span> </pre>

<p>
<a href="http://linux.die.net/man/8/lsof" class="urlextern" title="http://linux.die.net/man/8/lsof"  rel="nofollow"> lsof</a> este un utilitar care afișează informații despre fișierele deschise (ce fișiere sunt deschise în sistem, ce fișiere a deschis un anumit user etc). Căutați în manual (<code>man 8 lsof</code>) pentru a identifica semnificația coloanei FD și a coloanei TYPE.
</p>

<p>
Folosiți comanda ENTER pentru a continua programul. În paralel urmăriți cum se modifică tabela de file-descriptori.
</p>

<p>
În cod, observați parametrii cu care s-a realizat redirectarea cu ajutorul funcției<a href="http://linux.die.net/man/2/dup2" class="urlextern" title="http://linux.die.net/man/2/dup2"  rel="nofollow">dup2</a> (dup2(fd2, STDERR_FILENO)). Observați ce se întamplă dacă parametrii sunt în ordine inversă.
</p>
<ul>
<li class="level1"><div class="li"> revedeți secțiunea de <a href="#redirectari" title="so:laboratoare:laborator-02 ↵" class="wikilink1">redirectări</a></div>
</li>
</ul>

</div>

<h3 class="sectionedit27" id="exercitiul_2_-_lseek">Exercițiul 2 - lseek</h3>
<div class="level3">

<p>
Intrați în directorul <code>2-lseek</code> și urmăriți codul sursă din <code>lseek.c</code>.
Ce valoare va întoarce al doilea apel al funcției <code>lseek</code>? Decomentați linia de afișare, compilați și rulați pentru verificare.
</p>

<p>
Sursa închide doar file descriptorul <code>fd1</code>. Este nevoie să se închidă și file descriptorul <code>fd2</code>? De ce? 
</p>

</div>

<h3 class="sectionedit28" id="exercitiul_3_-_mcat">Exercițiul 3 - mcat</h3>
<div class="level3">

<p>
Intrați în directorul <code>3-mcat</code>.
</p>

</div>

<h4 id="a_similitudine_cat">3a. Similitudine cat</h4>
<div class="level4">

<p>
Completați fișierul astfel încât programul rezultat <code>mcat</code> să aibă funcționalitate similară cu a utilitarului <code>cat</code> (urmăriți comentariile cu <code>TODO 1</code>)
</p>

<p>
Programul <code>mcat</code> va primi ca argument în linia de comandă numele unui fișier al cărui conținut îl va afișa la ieșirea standard.
Nu aveți voie să citiți tot fișierul în memorie. Puteți citi doar bucăți de dimensiune maximum BUFSIZE.
</p>

<p>
<strong>Verificați codul de eroare</strong> întors de apelurile de sistem. Puteți folosi macro-ul <a href="http://elf.cs.pub.ro/so/wiki/laboratoare/resurse/die" class="urlextern" title="http://elf.cs.pub.ro/so/wiki/laboratoare/resurse/die"  rel="nofollow"> DIE</a>.
Revedeți secțiunile <a href="#crearea_deschiderea_si_inchiderea_fisierelor" title="so:laboratoare:laborator-02 ↵" class="wikilink1">Crearea, deschiderea și închiderea fișierelor</a> și <a href="#scrierea_si_citirea" title="so:laboratoare:laborator-02 ↵" class="wikilink1">Scrierea și citirea fișierelor</a>.
</p>

<p>
Testați cu o comandă de genul:  
</p>
<pre class="code bash">.<span class="sy0">/</span>mcat Makefile </pre>

</div>

<h4 id="b_similitudine_cp">3b. Similitudine cp</h4>
<div class="level4">

<p>
Extindeți funcționalitatea astfel încât output-ul să fie redirectat într-un fișier primit ca al doilea argument - funcționalitate similară cu a utilitarului <code>cp</code>. (urmăriți comentariile cu <code>TODO 2</code>)
</p>

<p>
Revedeți secțiunea de <a href="#redirectari" title="so:laboratoare:laborator-02 ↵" class="wikilink1">redirectări</a>.
</p>

<p>
Testați funcționalitatea: 
</p>
<pre class="code bash">.<span class="sy0">/</span>mcat Makefile out ; .<span class="sy0">/</span>mcat out </pre>

</div>

<h4 id="cdevnasty">3c. /dev/nasty</h4>
<div class="level4">

<p>
Inițializați fișierul <code>/dev/nasty</code>:
</p>
<pre class="code bash"><span class="kw2">sudo</span> <span class="kw2">apt-get install</span> linux-modules-$<span class="br0">&#40;</span><span class="kw2">uname</span> -r<span class="br0">&#41;</span> linux-headers-$<span class="br0">&#40;</span><span class="kw2">uname</span> -r<span class="br0">&#41;</span>
.<span class="sy0">/</span>set_nasty.sh</pre>

<p>
Încercați funcționalitatea de copiere pe fișierul <code>/dev/nasty</code>: 
</p>
<pre class="code bash">.<span class="sy0">/</span>mcat <span class="sy0">/</span>dev<span class="sy0">/</span>nasty
.<span class="sy0">/</span>mcat <span class="sy0">/</span>dev<span class="sy0">/</span>nasty out ; .<span class="sy0">/</span>mcat out </pre>

<p>
Dacă apar diferențe, fiți atenți la ce întorc funcțiile read și write (eventual afișați aceste valori) și reparați problema.
</p>

<p>
Testați <strong>scrierea</strong> cu: 
</p>
<pre class="code bash">.<span class="sy0">/</span>mcat Makefile <span class="sy0">/</span>dev<span class="sy0">/</span>nasty ; <span class="kw2">cat</span> <span class="sy0">/</span>dev<span class="sy0">/</span>nasty</pre>

<p>
<p><div class="notetip">
În cazul în care ultima comandă nu produce rezultatul așteptat, cel mai probabil nu ați tratat corect cazurile în care <code>read</code>/<code>write</code> întorc o valoare mai mică decât al treilea parametru - i.e. nu s-a citit/scris tot.  
</p>

<p>
<strong>Hint: </strong> Pentru a garanta scrierea/citirea numarului exact de bytes care este dat ca parametru, se recomanda apelarea read/write <strong>in bucla.</strong>
Implementarea xread/xwrite se bazeaza pe acest lucru.

</div></p>
</p>

</div>

<h2 class="sectionedit29" id="windows">Windows</h2>
<div class="level2">

<p>
<p><div class="noteimportant">Executabilele sunt generate în directorul <code>win/Debug</code> (în directorul <code>Debug</code> al soluției, nu al fiecărui proiect în parte).
</div></p>
</p>

</div>

<h3 class="sectionedit30" id="exercitiul_1_-_cat">Exercițiul 1 - cat</h3>
<div class="level3">

<p>
Deschideți folderul <code>win</code> din arhiva laboratorului 2 și intrați în proiectul <code>1-cat</code>, iar apoi urmăriți sursa <code>cat.c</code>
</p>

<p>
Compilați și testați executabilul <code>cat.exe</code> folosind command prompt-ul de Visual Studio: Tools → Visual Studio Command Prompt, sau folosind Makefile-ul.
</p>

<p>
<p><div class="noteclassic">
Observați că cei <code>bytesRead</code> octeți prin apelul <code>ReadFile</code> sunt scriși la <code>stdout</code> <strong>intr-o buclă</strong>, deoarece nu avem garanția că <code>WriteFile</code> va scrie întotdeauna atâția octeți cât îi specificăm prin al treilea parametru (<code>dwBytesToWrite</code>).
</p>

<p>
Folosiți această tehnică și la exercițiile următoare!

</div></p>
</p>

</div>

<h3 class="sectionedit31" id="exercitiul_2_-_crc">Exercițiul 2 - CRC</h3>
<div class="level3">

<p>
Exercițiul are ca scop realizarea unui utilitar care:
</p>
<ul>
<li class="level1"><div class="li"> Pentru un fișier dat, îi calculează CRC-ul și îl salvează într-un fișier de output.</div>
</li>
<li class="level1"><div class="li"> Pentru două fișiere date (în acest caz, de CRC), le compară și determină dacă sunt identice.</div>
</li>
</ul>

</div>

<h4 id="a_generare">2a. Generare</h4>
<div class="level4">

<p>
Deschideți fișierul <code>crc.c</code> din proiectul <code>2-crc</code> și completați funcția <code>GenerateCrc</code>.
</p>

<p>
Funcția primește ca prim argument fișierul pentru care trebuie calculat CRC-ul, iar ca al doilea argument fișierul în care se salvează CRC-ul. Algoritmul apelează iterativ funcția <code>update_crc</code> pentru bucăți de <code>BUFSIZE = 512</code> bytes din fișierul de input. La ultima bucată se va face padding.
</p>

<p>
Revedeți secțiunile <a href="#crearea_deschiderea_si_inchiderea" title="so:laboratoare:laborator-02 ↵" class="wikilink1">Crearea, deschiderea și închiderea fișierelor</a>, cât și <a href="#citirea_si_scrierea" title="so:laboratoare:laborator-02 ↵" class="wikilink1">Citirea și scrierea fișierelor</a>.
</p>

<p>
Urmăriți comentariile cu <code>TODO 1</code>. Pentru testare folosiți-vă de fișierele din directorul <code>tests</code>. Pentru a compara două fișiere, puteți folosi utilitarul <code>comp</code> astfel:
</p>
<pre class="code">PS C:...&gt; .\crc.exe -g tests\test_in\test1.in crc1.out
PS C:...&gt; comp.exe crc1.out tests\test_out\test1.out</pre>

</div>

<h4 id="b_comparare">2b. Comparare</h4>
<div class="level4">

<p>
Odată calculat fișierul cu CRC, vrem să vedem dacă două fișiere de CRC sunt egale. Extindeți funcționalitatea programului anterior astfel încât să compare 2 fișiere. Vom lucra în funcția <code>CompareFiles</code>.
</p>

<p>
Inițial comparați dimensiunile fișierelor astfel:
</p>
<ul>
<li class="level1"><div class="li"> Completați funcția <code>GetSize</code> pentru calcularea dimensiunii unui fișier, urmărind comentariile din <code>TODO 2</code></div>
</li>
<li class="level1"><div class="li"> Folosiți doar funcția <code><a href="http://msdn.microsoft.com/en-us/library/aa365541%28VS.85%29.aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/aa365541%28VS.85%29.aspx"  rel="nofollow">SetFilePointer</a></code></div>
</li>
</ul>

<p>
Dacă dimensiunile sunt egale, comparați cele 2 fișiere bucată cu bucată. Funcția trebuie să compare corect cele două fișiere, indiferent de dimensiunea acestora. Nu citiți tot fișierul în memorie, ci câte <code>CHUNKSIZE = 32</code> bytes o dată. Pentru aceasta, va trebui să implementați funcția <code>ReadChunk</code>, urmand indicațiile de la <code>TODO 3</code>. Apoi, urmăriți comentariile marcate cu <code>TODO 4</code>.
</p>

<p>
<p><div class="noteimportant">
Pentru a putea compara un fișier cu el însuși, va trebui ca în cadrul funcției <code>CompareFiles</code> să deschideți ambele fișiere folosind <code>FILE_SHARE_READ</code>.

</div></p>
</p>

</div>

<h3 class="sectionedit32" id="bonus_-_linux">BONUS - Linux</h3>
<div class="level3">

</div>

<h5 id="troubleshooting">Troubleshooting</h5>
<div class="level5">

<p>
Intrați în directorul <code>4-trouble</code>. Compilați și rulați programul <code>trouble</code>.
</p>

<p>
Programul ar trebui să afișeze în fișierul <code>tmp1.txt</code> mesajul din <code>msg</code>. Afișați fișierul <code>tmp1.txt</code>.
</p>

<p>
Ce observați? Identificați și remediați problema. Revedeți secțiunea: <a href="#crearea_deschiderea_si_inchiderea_fisierelor" title="so:laboratoare:laborator-02 ↵" class="wikilink1">Crearea, deschiderea și închiderea fișierelor</a>.
</p>

</div>

<h5 id="file_lock">File lock</h5>
<div class="level5">

<p>
Vrem să ne asigurăm că doar <strong>o instanță</strong> a unui program rulează la un moment dat. Pentru asta se creează un fișier temporar pe care se încearcă obținerea unui lock folosind apelul <a href="http://linux.die.net/man/2/flock" class="urlextern" title="http://linux.die.net/man/2/flock"  rel="nofollow"> flock</a>.
</p>

<p>
Intrați în directorul <code>5-singular</code> și completați sursa <code>singular.c</code> (urmăriți comentariile cu TODO ).
<p><div class="noteimportant"> Hint: <code>man 2 flock</code>, <code><em>nonblocking</em></code> 
</div></p>
</p>

<p>
Testați rulând executabilul din două terminale diferite, sau cu comanda: 
</p>
<pre class="code bash">.<span class="sy0">/</span>singular <span class="sy0">&amp;</span> <span class="kw2">sleep</span> <span class="nu0">3</span> ; .<span class="sy0">/</span>singular</pre>

<p>
Găsiți o metodă prin care ne putem asigura că programul nostru are doar o singură instanță, folosind mai <strong>puține</strong> apeluri de sistem.
</p>

</div>

<h3 class="sectionedit33" id="bonus_-_windows">BONUS - Windows</h3>
<div class="level3">

<p>
Utilitar echivalent cu <code>ls -a -R</code>.
</p>

</div>

<h4 id="creare_utilitar_ls">Creare utilitar ls</h4>
<div class="level4">

<p>
Deschideți din arhiva laboratorului 2 proiectul <code>3-ls</code>. Completați fișierul <code>ls.c</code> pentru ca programul <code>ls.exe</code> să se comporte ca utilitarul <code>ls</code>.
</p>

<p>
Afișarea fișierelor dintr-un director se face în doi pași:
</p>
<ul>
<li class="level1"><div class="li"> se obține un handle la o primă intrare din lista de fișiere a directorului cu funcția: <a href="http://msdn.microsoft.com/en-us/library/aa364418%28VS.85%29.aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/aa364418%28VS.85%29.aspx"  rel="nofollow">FindFirstFile</a></div>
</li>
<li class="level2"><div class="li"> se iterează această listă folosind funcția: <a href="http://msdn.microsoft.com/en-us/library/aa364428%28VS.85%29.aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/aa364428%28VS.85%29.aspx"  rel="nofollow">FindNextFile</a></div>
</li>
</ul>

<p>
Pentru rezolvare, urmăriți comentariile marcate cu  <code>TODO 1</code>. Ca să afișați detaliile cu o spațiere consecventă, folosiți funcția <code>PrintPadding</code> definită în schelet, iar pentru testare, folosiți dintr-un prompt Visual Studio: 
</p>
<pre class="code bash">ls.exe ..</pre>

</div>

<h5 id="afisare_detalii_pentru_parametrul_-a">Afișare detalii pentru parametrul -a</h5>
<div class="level5">

<p>
Pentru fișiere afișați numele, dimensiunea și data la care au fost modificate ultima oară.
Pentru directoare afișați numele și un indicator de director (ex: &lt;DIR&gt; nume ).
</p>

<p>
Atributele unui fișier sunt definite într-o structură de forma: <a href="http://msdn.microsoft.com/en-us/library/aa365740%28VS.85%29.aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/aa365740%28VS.85%29.aspx"  rel="nofollow">WIN32_FIND_DATA</a>. Pentru a verifica dacă un fișier e director, trebuie să aibă bitul “FILE_ATTRIBUTE_DIRECTORY”  din câmpul “dwFileAttributes” ( vezi <a href="http://msdn.microsoft.com/en-us/library/ee332330%28v=VS.85%29.aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/ee332330%28v=VS.85%29.aspx"  rel="nofollow">File Attributes</a>).
</p>
<ul>
<li class="level1"><div class="li"> Urmăriți comentariile marcate cu  <code>TODO 2</code>.</div>
</li>
<li class="level1"><div class="li"> Pentru a afișa detaliile cu o spațiere consecventă, folosiți funcția <code>PrintPadding</code> definită în schelet.</div>
</li>
</ul>

</div>

<h5 id="afisare_detalii_pentru_parametrul_-r">Afișare detalii pentru parametrul -R</h5>
<div class="level5">

<p>
Realizați parcurgerea recursivă a directoarelor prin apelarea recursivă a funcției <code>ListFile</code>.
</p>

<p>
Pentru rezolvare, urmăriți comentariile marcate cu <code>TODO 3</code>. Aveți grijă să concatenați numele noului director la calea deja existentă.
</p>

</div>

<h4 id="troubleshooting1">Troubleshooting</h4>
<div class="level4">

<p>
Deschideți din arhiva laboratorului 2 proiectul <code>4-trouble</code>. Programul ar trebui să creeze un fișier cu mesajul “Testing 123”.
</p>

<p>
Compilați și rulați programul <code>trouble</code>. Identificați și remediați problema.
</p>

<p>
Revedeți secțiunea: <a href="#crearea_deschiderea_si_inchiderea" title="so:laboratoare:laborator-02 ↵" class="wikilink1">Crearea, deschiderea și închiderea fișierelor</a>.
</p>

</div>

<h3 class="sectionedit34" id="extra">EXTRA</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li">Operații cu fișiere în Python</div>
</li>
<li class="level2"><div class="li">Studiați exemplele din <a href="/courses/_media/so/laboratoare/pyfileoperations.zip" class="media mediafile mf_zip" title="so:laboratoare:pyfileoperations.zip (2.2 KB)">arhivă</a>, citiți documentația și observați diferențele între <abbr title="Application Programming Interface">API</abbr>-uri</div>
</li>
</ul>

</div>

<h2 class="sectionedit35" id="resurse_utile">Resurse utile</h2>
<div class="level2">
<ol>
<li class="level1"><div class="li"> <a href="http://www.gnu.org/software/libc/manual/html_node/Low_002dLevel-I_002fO.html" class="urlextern" title="http://www.gnu.org/software/libc/manual/html_node/Low_002dLevel-I_002fO.html"  rel="nofollow">Low level I/O</a> (info libc “Low-Level I/O”)</div>
</li>
<li class="level1"><div class="li"> <a href="http://www.gnu.org/software/libc/manual/html_node/Duplicating-Descriptors.html" class="urlextern" title="http://www.gnu.org/software/libc/manual/html_node/Duplicating-Descriptors.html"  rel="nofollow">Duplicating descriptors</a> (info libc “Duplicating Descriptors”)</div>
</li>
<li class="level1"><div class="li"> <a href="http://www.advancedlinuxprogramming.com/alp-folder/alp-apB-low-level-io.pdf" class="urlextern" title="http://www.advancedlinuxprogramming.com/alp-folder/alp-apB-low-level-io.pdf"  rel="nofollow">Low level I/O</a> (Advanced Linux Programming)</div>
</li>
<li class="level1"><div class="li"> <a href="http://msdn.microsoft.com/en-us/library/aa364232%28VS.85%29.aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/aa364232%28VS.85%29.aspx"  rel="nofollow"> File management functions</a></div>
</li>
</ol>

</div>

        </div>
        <div class="right_sidebar">
          <form action="/courses/start" accept-charset="utf-8" class="search" id="dw__search" method="get"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><input type="submit" value="Search" class="button" title="Search" /><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>          <div class="namespace_sidebar sidebar_box">



<h1 class="sectionedit1" id="informatii_generale_so">Informații generale SO</h1>
<div class="level1">

<div><div id="nojs_indexmenu_6798845046348403174ff2" data-jsajax="%26skipfile%3D%253D/so%253Ainfo%253Astart/" class="indexmenu_nojs">

<ul class="idx">
<li class="level1"><div class="li"><a href="/courses/so/info/catalog" class="wikilink1" title="so:info:catalog">Catalog</a></div></li>
<li class="level1"><div class="li"><a href="/courses/so/info/documentatie" class="wikilink1" title="so:info:documentatie">Documentație și alte resurse</a></div></li>
<li class="level1"><div class="li"><a href="/courses/so/info/feed" class="wikilink1" title="so:info:feed">Feed RSS</a></div></li>
<li class="level1"><div class="li"><a href="/courses/so/info/hall" class="wikilink1" title="so:info:hall">Hall of SO</a></div></li>
<li class="level1"><div class="li"><a href="/courses/so/info/lista-discutii" class="wikilink1" title="so:info:lista-discutii">Listă de discuții</a></div></li>
<li class="level1"><div class="li"><a href="/courses/so/info/mv" class="wikilink1" title="so:info:mv">Mașini virtuale</a></div></li>
<li class="level1"><div class="li"><a href="/courses/so/info/trimitere-teme" class="wikilink1" title="so:info:trimitere-teme">Trimitere teme</a></div></li>
</ul>
</div></div>

</div>
<!-- EDIT1 SECTION "Informații generale SO" [12-194] -->
<h1 class="sectionedit2" id="informatii_so_2021-2022">Informații SO 2021-2022</h1>
<div class="level1">

<div><div id="nojs_indexmenu_1715359816348403177eee" data-jsajax="" class="indexmenu_nojs">

<ul class="idx">
<li class="open"><div class="li"><a href="/courses/so/meta/examen" class="indexmenu_idx_head">Examen</a></div>
<ul class="idx">
<li class="level2"><div class="li"><a href="/courses/so/meta/examen/2012-2013" class="wikilink1" title="so:meta:examen:2012-2013">Examen CA/CC 2012-2013</a></div></li>
<li class="level2"><div class="li"><a href="/courses/so/meta/examen/2013-2014" class="wikilink1" title="so:meta:examen:2013-2014">Examen CA/CC 2013-2014</a></div></li>
<li class="level2"><div class="li"><a href="/courses/so/meta/examen/2014-2015" class="wikilink1" title="so:meta:examen:2014-2015">Examen CA/CC 2014-2015</a></div></li>
<li class="level2"><div class="li"><a href="/courses/so/meta/examen/2015-2016" class="wikilink1" title="so:meta:examen:2015-2016">Examen CA/CC 2015-2016</a></div></li>
<li class="level2"><div class="li"><a href="/courses/so/meta/examen/2016-2017" class="wikilink1" title="so:meta:examen:2016-2017">Examen CA/CB/CC 2016-2017</a></div></li>
<li class="level2"><div class="li"><a href="/courses/so/meta/examen/2017-2018" class="wikilink1" title="so:meta:examen:2017-2018">Examen CA/CB/CC 2017-2018</a></div></li>
<li class="level2"><div class="li"><a href="/courses/so/meta/examen/2018-2019" class="wikilink1" title="so:meta:examen:2018-2019">Examen CA/CB/CC 2018-2019</a></div></li>
<li class="level2"><div class="li"><a href="/courses/so/meta/examen/2019-2020" class="wikilink1" title="so:meta:examen:2019-2020">Examen CA/CB/CC 2019-2020</a></div></li>
<li class="level2"><div class="li"><a href="/courses/so/meta/examen/2020-2021" class="wikilink1" title="so:meta:examen:2020-2021">Examen CA/CB/CC 2020-2021</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="/courses/so/meta/anunturi" class="wikilink1" title="so:meta:anunturi">Anunțuri</a></div></li>
<li class="level1"><div class="li"><a href="/courses/so/meta/calendar" class="wikilink1" title="so:meta:calendar">Calendar</a></div></li>
<li class="level1"><div class="li"><a href="/courses/so/meta/echivalari" class="wikilink1" title="so:meta:echivalari">Echivalări teme</a></div></li>
<li class="level1"><div class="li"><a href="/courses/so/meta/hit_list" class="wikilink1" title="so:meta:hit_list">Distincții</a></div></li>
<li class="level1"><div class="li"><a href="/courses/so/meta/karma" class="wikilink1" title="so:meta:karma">Karma Awards</a></div></li>
<li class="level1"><div class="li"><a href="/courses/so/meta/need-to-know" class="wikilink1" title="so:meta:need-to-know">SO Need to Know</a></div></li>
<li class="level1"><div class="li"><a href="/courses/so/meta/notare" class="wikilink1" title="so:meta:notare">Reguli generale și notare</a></div></li>
<li class="level1"><div class="li"><a href="/courses/so/meta/orar" class="wikilink1" title="so:meta:orar">Orar și împărțire pe semigrupe</a></div></li>
</ul>
</div></div>

</div>
<!-- EDIT2 SECTION "Informații SO 2021-2022" [195-261] -->
<h1 class="sectionedit3" id="laboratoare">Laboratoare</h1>
<div class="level1">

<p>
Accesibile pe GitHub, în <a href="https://github.com/open-education-hub/operating-systems-oer" class="urlextern" title="https://github.com/open-education-hub/operating-systems-oer"  rel="nofollow">organizația Open Education Hub</a>
</p>

</div>
<!-- EDIT3 SECTION "Laboratoare" [262-453] -->
<h1 class="sectionedit4" id="curs">Curs</h1>
<div class="level1">

<p>
Accesibile pe GitHub, în <a href="https://github.com/open-education-hub/operating-systems-oer" class="urlextern" title="https://github.com/open-education-hub/operating-systems-oer"  rel="nofollow">organizația Open Education Hub</a>
</p>

</div>
<!-- EDIT4 SECTION "Curs" [454-1442] -->
<h1 class="sectionedit5" id="teme">Teme</h1>
<div class="level1">

<div><div id="nojs_indexmenu_21186051036348403179e17" data-jsajax="" class="indexmenu_nojs">

<ul class="idx">
<li class="closed"><div class="li"><a href="/courses/so/teme/tema-asist" class="indexmenu_idx_head">Tema Asistenți - Guardian process</a></div></li>
<li class="level1"><div class="li"><a href="/courses/so/teme/contestatii" class="wikilink1" title="so:teme:contestatii">Contestații</a></div></li>
<li class="level1"><div class="li"><a href="/courses/so/teme/folosire-gitlab" class="wikilink1" title="so:teme:folosire-gitlab">Git. Indicații folosire GitLab</a></div></li>
<li class="level1"><div class="li"><a href="/courses/so/teme/general" class="wikilink1" title="so:teme:general">Indicații generale teme</a></div></li>
<li class="level1"><div class="li"><a href="/courses/so/teme/hackathon" class="wikilink1" title="so:teme:hackathon">Hackathon SO</a></div></li>
<li class="level1"><div class="li"><a href="/courses/so/teme/tema-1" class="wikilink1" title="so:teme:tema-1">Tema 1 Multi-platform Development</a></div></li>
<li class="level1"><div class="li"><a href="/courses/so/teme/tema-2" class="wikilink1" title="so:teme:tema-2">Tema 2 Bibliotecă stdio</a></div></li>
<li class="level1"><div class="li"><a href="/courses/so/teme/tema-3" class="wikilink1" title="so:teme:tema-3">Tema 3 Loader de Executabile</a></div></li>
<li class="level1"><div class="li"><a href="/courses/so/teme/tema-4" class="wikilink1" title="so:teme:tema-4">Tema 4 Planificator de threaduri</a></div></li>
<li class="level1"><div class="li"><a href="/courses/so/teme/tema-5" class="wikilink1" title="so:teme:tema-5">Tema 5 Server web asincron</a></div></li>
</ul>
</div></div>

</div>
<!-- EDIT5 SECTION "Teme" [1443-] -->
</div>
<div class="toc_sidebar sidebar_box">
<!-- TOC START -->
<div id="sb__right__dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="#laborator_02_-_operatii_io_simple">Laborator 02 - Operații I/O simple</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="#materiale_ajutatoare">Materiale ajutătoare</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="#nice_to_read">Nice to read</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="#fisiere_sisteme_de_fisiere">Fișiere. Sisteme de fișiere</a></div></li>
<li class="level2"><div class="li"><a href="#operatii_pe_fisiere">Operații pe fișiere</a></div></li>
<li class="level2"><div class="li"><a href="#operatii_pe_fisiere_in_linux">Operații pe fișiere în Linux</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="#crearea_deschiderea_si_inchiderea_fisierelor">Crearea, deschiderea și închiderea fișierelor</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="#open">open</a></div></li>
<li class="level4"><div class="li"><a href="#creat">creat</a></div></li>
<li class="level4"><div class="li"><a href="#close">close</a></div></li>
<li class="level4"><div class="li"><a href="#unlink">unlink</a></div></li>
<li class="level4"><div class="li"><a href="#exemplu">Exemplu</a></div></li>
</ul>
</li>
<li class="level3"><div class="li"><a href="#scrierea_si_citirea">Scrierea și citirea</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="#read">read</a></div></li>
<li class="level4"><div class="li"><a href="#write">write</a></div></li>
</ul>
</li>
<li class="level3"><div class="li"><a href="#pozitionarea_in_fisier_lseek">Poziționarea în fișier (lseek)</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="#lseek">lseek</a></div></li>
</ul>
</li>
<li class="level3"><div class="li"><a href="#trunchierea_fisierelor">Trunchierea fișierelor</a></div></li>
<li class="level3"><div class="li"><a href="#exemplu_utilizare_operatii_io">Exemplu utilizare operații I/O</a></div></li>
<li class="level3"><div class="li"><a href="#redirectari">Redirectări</a></div></li>
<li class="level3"><div class="li"><a href="#operatii_speciale">Operații speciale</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="#operatii_pe_fisiere_in_windows">Operații pe fișiere în Windows</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="#crearea_deschiderea_si_inchiderea">Crearea, deschiderea și închiderea</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="#createfile">CreateFile</a></div></li>
<li class="level4"><div class="li"><a href="#closehandle">CloseHandle</a></div></li>
<li class="level4"><div class="li"><a href="#deletefile">DeleteFile</a></div></li>
</ul>
</li>
<li class="level3"><div class="li"><a href="#citirea_si_scrierea">Citirea și scrierea</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="#readfile">ReadFile</a></div></li>
<li class="level4"><div class="li"><a href="#writefile">WriteFile</a></div></li>
</ul>
</li>
<li class="level3"><div class="li"><a href="#pozitionarea_in_fisier">Poziționarea în fișier</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="#setfilepointer">SetFilePointer</a></div></li>
</ul>
</li>
<li class="level3"><div class="li"><a href="#trunchierea_fisierelor1">Trunchierea fișierelor</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="#setendoffile">SetEndOfFile</a></div></li>
</ul>
</li>
<li class="level3"><div class="li"><a href="#exemplu1">Exemplu</a></div></li>
<li class="level3"><div class="li"><a href="#wrapper-e">Wrapper-e</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="#exercitii">Exerciții</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="#exercitiul_0_-_stagii_pe_bune">Exercițiul 0 - Stagii pe bune</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="#linux">Linux</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="#exercitiul_1_-_redirect">Exercițiul 1 - redirect</a></div></li>
<li class="level3"><div class="li"><a href="#exercitiul_2_-_lseek">Exercițiul 2 - lseek</a></div></li>
<li class="level3"><div class="li"><a href="#exercitiul_3_-_mcat">Exercițiul 3 - mcat</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="#a_similitudine_cat">3a. Similitudine cat</a></div></li>
<li class="level4"><div class="li"><a href="#b_similitudine_cp">3b. Similitudine cp</a></div></li>
<li class="level4"><div class="li"><a href="#cdevnasty">3c. /dev/nasty</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="level2"><div class="li"><a href="#windows">Windows</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="#exercitiul_1_-_cat">Exercițiul 1 - cat</a></div></li>
<li class="level3"><div class="li"><a href="#exercitiul_2_-_crc">Exercițiul 2 - CRC</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="#a_generare">2a. Generare</a></div></li>
<li class="level4"><div class="li"><a href="#b_comparare">2b. Comparare</a></div></li>
</ul>
</li>
<li class="level3"><div class="li"><a href="#bonus_-_linux">BONUS - Linux</a></div></li>
<li class="level3"><div class="li"><a href="#bonus_-_windows">BONUS - Windows</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="#creare_utilitar_ls">Creare utilitar ls</a></div></li>
<li class="level4"><div class="li"><a href="#troubleshooting1">Troubleshooting</a></div></li>
</ul>
</li>
<li class="level3"><div class="li"><a href="#extra">EXTRA</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="#resurse_utile">Resurse utile</a></div></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->
</div>
        </div>
      
    
      <div class="stylefoot">
        <div class="meta">
          <div class="user">
                    </div>
          <div class="doc">
          so/laboratoare/laborator-02.txt · Last modified: 2022/03/11 16:38 by aapostolescu          </div>
        </div>
      </div>

    <div class="clearer"></div>

    
                <div class="bar" id="bar__bottom">
      <div class="bar-left">
        <a href="/courses/so/laboratoare/laborator-02?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Old revisions [O]">Old revisions</a>      </div>
      <div class="bar-right">
        <a href="/courses/so/laboratoare/laborator-02?do=media&amp;ns=so%3Alaboratoare"  class="action media" rel="nofollow" title="Media Manager">Media Manager</a><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Back to top [T]">Back to top</a>      </div>
    </div>
    <div class="clearer"></div>
            
    <div align="center" class="footerinc">
  <div class="license"><a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="/courses/lib/images/license/button/cc-by-sa.png" alt="CC Attribution-Share Alike 3.0 Unported" /></a></div>
  <a target="_blank" href="http://www.chimeric.de" title="www.chimeric.de"><img src="/courses/lib/tpl/arctic/images/button-chimeric-de.png" width="80" height="15" alt="www.chimeric.de" border="0" /></a>

  <a target="_blank" href="http://jigsaw.w3.org/css-validator/check/referer" title="Valid CSS"><img src="/courses/lib/tpl/arctic/images/button-css.png" width="80" height="15" alt="Valid CSS" border="0" /></a>

  <a target="_blank" href="http://wiki.splitbrain.org/wiki:dokuwiki" title="Driven by DokuWiki"><img src="/courses/lib/tpl/arctic/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" border="0" /></a>

  <a target="_blank" href="http://www.firefox-browser.de" title="do yourself a favour and use a real browser - get firefox"><img src="/courses/lib/tpl/arctic/images/button-firefox.png" width="80" height="15" alt="do yourself a favour and use a real browser - get firefox!!" border="0" /></a>
  
  <a target="_blank" href="/courses/feed.php" title="Recent changes RSS feed"><img src="/courses/lib/tpl/arctic/images/button-rss.png" width="80" height="15" alt="Recent changes RSS feed" border="0" /></a>

  <a target="_blank" href="http://validator.w3.org/check/referer" title="Valid XHTML 1.0"><img src="/courses/lib/tpl/arctic/images/button-xhtml.png" width="80" height="15" alt="Valid XHTML 1.0" border="0" /></a>
</div>

  </div>
</div>

<div class="no"><img src="/courses/lib/exe/indexer.php?id=so%3Alaboratoare%3Alaborator-02&amp;1665679409" width="2" height="1" alt="" /></div>
</body>
</html>
